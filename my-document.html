<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Document | Talimi Ittehad</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f1f5f9;}
header{background:#1e40af;color:#fff;font-weight:700;text-align:center;padding:1rem;font-size:1.25rem;}
.btn-3d{background:linear-gradient(90deg,#4d94ff,#4dffb8);color:#fff;font-weight:700;border-radius:10px;padding:.35rem .7rem;font-size:.85rem;
box-shadow:0 4px 0 rgba(0,0,0,.25),0 6px 10px rgba(0,0,0,.2);transition:transform .12s ease,box-shadow .12s ease,filter .12s;cursor:pointer;}
.btn-3d:hover{filter:brightness(1.1);transform:translateY(-2px);}
.upload-area{border:2px dashed #4d94ff;padding:20px;text-align:center;border-radius:10px;cursor:pointer;transition:.3s;}
.upload-area.dragover{background:#e0f7ff;}
.progress-bar{height:6px;background:#4d94ff;border-radius:3px;margin-top:5px;transition:width .2s;}
.gallery-img{cursor:pointer;transition:transform .2s;}
.gallery-img:hover{transform:scale(1.05);}
#lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:50;align-items:center;justify-content:center;}
#lightbox img{max-height:90%;max-width:90%;border-radius:.5rem;box-shadow:0 0 20px rgba(0,0,0,.6);}
#lightbox button{position:absolute;top:20px;right:20px;background:#f44336;color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;}
.admin-btn{display:inline-block;margin:2px;padding:2px 6px;border-radius:5px;font-size:0.7rem;color:#fff;cursor:pointer;}
.admin-delete{background:#dc2626;}
</style>
</head>


   <!-- Header with Logo and 3D Buttons -->
<header class="bg-blue-600" style="height:100px;"> <!-- header height thoda kam kiya -->
  <div class="max-w-6xl mx-auto px-4 py-2 h-full flex flex-col justify-between">

    <!-- Top: 3D Buttons -->
   <div class="flex justify-center gap-4">
  <a href="nikah.html">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#ff4d4d,#ff914d);">ğŸ’ Nikah</button>
  </a>
  <a href="news.html">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#4dffb8,#4d94ff);">ğŸ“° News</button>
  </a>
  <a href="hadees.html">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#d24dff,#ff4dd2);">ğŸ“œ Hadees</button>
  </a>
</div>


    <!-- Middle: Logo and Side Images -->
    <div class="flex justify-between items-center h-full mt-1">

      <!-- Left: Makka -->
      <div class="flex items-center">
        <img src="makka.png" alt="Makka" class="header-png">
      </div>

    <!-- Center: Logo / Title -->
<div class="flex flex-col items-center justify-center h-full">
  <div class="text-white font-bold text-2xl" 
       style="text-shadow:2px 2px 8px rgba(0,0,0,.9); transform: translateY(-8px);">
    Talimi Ittehad
  </div>
</div>


      <!-- Right: Madina -->
      <div class="flex items-center">
        <img src="madina.png" alt="Madina" class="header-png">
      </div>

    </div>
  </div>
</header>

<style>
/* 3D Buttons Base */
.btn-3d-special {
  color: #fff;
  font-weight: 700;
  border-radius: 10px;
  box-shadow: 0 6px 0 rgba(0,0,0,.25), 0 8px 14px rgba(0,0,0,.25);
  transition: transform .12s ease, box-shadow .12s ease;
}
.btn-3d-special:active {
  transform: translateY(3px);
  box-shadow: 0 3px 0 rgba(0,0,0,.25);
}

/* Small variant for top header buttons */
.btn-small {
  font-size: 0.85rem;
  padding: 0.4rem 0.9rem;
}

/* Header PNG images */
.header-png {
  height: 70px;           /* image height */
  width: 70px;            /* image width */
  object-fit: cover;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>








<!-- Namaz Times Box -->
<div id="prayer-times" 
     class="bg-green-700 text-white text-xs sm:text-sm px-3 py-2 rounded shadow text-left leading-5 mt-2 sm:mt-0 sm:ml-4">
  ğŸ•Œ Loading...
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // âœ… Tumhara fixed timetable
  const timings = {
    "Fajr": "05:10",
    "Dhuhr": "12:20",
    "Asr": "04:00",
    "Maghrib": "06:15",
    "Isha": "07:45"
  };

  // âœ… Show times
  document.getElementById("prayer-times").innerHTML = `
    ğŸŒ… Fajr: ${timings.Fajr} &nbsp;|&nbsp;
    â˜€ Dhuhr: ${timings.Dhuhr} &nbsp;|&nbsp;
    ğŸŒ‡ Asr: ${timings.Asr} &nbsp;|&nbsp;
    ğŸŒ† Maghrib: ${timings.Maghrib} &nbsp;|&nbsp;
    ğŸŒ™ Isha: ${timings.Isha}
  `;
});
</script>


  
  

   
  <!-- Left: Home Button -->
  <div>
 <a href="index.html" class="btn-3d-home px-1 py-0.5 text-xs rounded font-bold flex items-center justify-center">
  ğŸ  Home
</a>

  


<style>
/* 3D Button Style */
.btn-3d-home {
  background: linear-gradient(90deg,#ff4d4d,#4d94ff);
  color: white;
  font-weight: 700;
  box-shadow: 0 6px 0 rgba(0,0,0,0.25), 0 8px 14px rgba(0,0,0,0.25);
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}
.btn-3d-home:active {
  transform: translateY(3px);
  box-shadow: 0 3px 0 rgba(0,0,0,0.25);
}
</style>
  
<body>

<header>ğŸ“„ My Document</header>

<!-- Admin Upload -->
<div id="adminUpload" class="hidden max-w-md mx-auto mt-4 p-4 bg-white rounded shadow">
  <h2 class="font-semibold mb-2">ğŸ–¼ Upload New Document Image</h2>
  <div id="uploadArea" class="upload-area mb-2">Drag & Drop Image or Click to Select (JPG/PNG/GIF)</div>
  <input id="fileInput" type="file" accept="image/*" class="hidden"/>
  <input id="docTitle" type="text" placeholder="Document Title" class="mb-2 w-full rounded border p-1"/>
  <div class="w-full bg-gray-300 rounded overflow-hidden mb-2"><div id="progress" class="progress-bar w-0"></div></div>
  <button id="uploadBtn" class="btn-3d w-full py-2">Upload Image</button>
</div>

<main class="max-w-4xl mx-auto p-4">
  <div id="docList" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
  <p id="emptyMsg" class="text-gray-500 text-sm mt-4 hidden">âš ï¸ No documents uploaded yet.</p>
</main>

<div id="lightbox" class="flex">
  <img src="" alt="preview" id="lightbox-img">
  <button id="closeLightbox">âœ–</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, onAuthStateChanged, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e387e1297663b11fc2463b11fc2463b"
};

const ADMIN_EMAIL = "zaradigitalseva@gmail.com";
const IMGBB_API_KEY = "d12c2e4a8650157b2b6b9fe85336ea43";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const adminBox = document.getElementById("adminUpload");
const uploadArea = document.getElementById("uploadArea");
const fileInput = document.getElementById("fileInput");
const docTitle = document.getElementById("docTitle");
const uploadBtn = document.getElementById("uploadBtn");
const progressBar = document.getElementById("progress");
const docList = document.getElementById("docList");
const emptyMsg = document.getElementById("emptyMsg");

let currentUser = null;

// ====================
// Base64 convert
function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=()=>resolve(reader.result.split(",")[1]);
    reader.onerror=e=>reject(e);
    reader.readAsDataURL(file);
  });
}

// ====================
// Upload to ImgBB
async function uploadToImgBB(file){
  const base64 = await toBase64(file);
  const fd = new FormData();
  fd.append("image", base64);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,{method:"POST",body:fd});
  const data = await res.json();
  if(data.success) return data.data.url;
  else throw new Error("Upload failed");
}

// ====================
// Drag & Drop
uploadArea.addEventListener("click",()=>fileInput.click());
uploadArea.addEventListener("dragover",e=>{ e.preventDefault(); uploadArea.classList.add("dragover"); });
uploadArea.addEventListener("dragleave",e=>{ e.preventDefault(); uploadArea.classList.remove("dragover"); });
uploadArea.addEventListener("drop",e=>{
  e.preventDefault();
  uploadArea.classList.remove("dragover");
  fileInput.files = e.dataTransfer.files;
});

// ====================
// Upload Button
uploadBtn.onclick = async()=>{
  if(!currentUser || currentUser.email!==ADMIN_EMAIL){ alert("Only admin can upload!"); return; }
  const file = fileInput.files[0];
  if(!file) return alert("Select an image!");
  const title = docTitle.value.trim();
  if(!title) return alert("Enter document title!");
  uploadBtn.textContent="â³ Uploading...";
  progressBar.style.width="0%";

  try{
    const url = await uploadToImgBB(file);
    await addDoc(collection(db,"my_documents"),{title,url,createdAt:serverTimestamp()});
    docTitle.value=""; fileInput.value="";
    uploadBtn.textContent="âœ… Done"; progressBar.style.width="0%";
    loadDocs();
  }catch(e){ alert("Upload error: "+e.message); uploadBtn.textContent="Upload Image"; progressBar.style.width="0%"; }
};

// ====================
// Load Documents
async function loadDocs(){
  docList.innerHTML="";
  const q=query(collection(db,"my_documents"),orderBy("createdAt","desc"));
  const snap=await getDocs(q);
  if(snap.empty){ emptyMsg.classList.remove("hidden"); return; }
  emptyMsg.classList.add("hidden");

  snap.forEach(docSnap=>{
    const d=docSnap.data();
    const wrapper=document.createElement("div");
    wrapper.className="relative";

    const img=document.createElement("img");
    img.src=d.url;
    img.alt=d.title;
    img.className="gallery-img rounded shadow w-full";
    img.onclick=()=>{ document.getElementById("lightbox").style.display="flex"; document.getElementById("lightbox-img").src=d.url; };
    wrapper.appendChild(img);

    const caption=document.createElement("div");
    caption.textContent=d.title;
    caption.className="text-center text-sm mt-1";
    wrapper.appendChild(caption);

    if(currentUser && currentUser.email===ADMIN_EMAIL){
      const delBtn = document.createElement("button");
      delBtn.textContent="Delete";
      delBtn.className="admin-btn admin-delete mt-1";
      delBtn.onclick=async()=>{ if(confirm("Delete this document?")){ await deleteDoc(doc(db,"my_documents",docSnap.id)); loadDocs(); } };
      wrapper.appendChild(delBtn);
    }

    docList.appendChild(wrapper);
  });
}

// ====================
// Auth
onAuthStateChanged(auth,user=>{
  currentUser=user;
  if(user && user.email===ADMIN_EMAIL){ adminBox.classList.remove("hidden"); }
  if(!user){ signInWithPopup(auth,provider); }
  loadDocs();
});

// ====================
// Lightbox
document.getElementById("closeLightbox").onclick=()=>document.getElementById("lightbox").style.display="none";
document.getElementById("lightbox").onclick=e=>{ if(e.target.id==="lightbox") document.getElementById("lightbox").style.display="none"; };

</script>

</body>
</html>
