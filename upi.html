<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ’ Donate | Talimi Ittehad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .title-3d{font-weight:700;font-size:1.5rem;color:#fff;text-shadow:2px 2px 6px rgba(0,0,0,.8);}
    .btn-3d{background:linear-gradient(135deg,#4f46e5,#9333ea);color:#fff;padding:.5rem 1rem;border-radius:.5rem;box-shadow:0 3px 6px rgba(0,0,0,.3);transition:.2s;}
    .btn-3d:hover{transform:translateY(-2px);box-shadow:0 5px 10px rgba(0,0,0,.4);}
    .card-3d{background:#fff;border-radius:.8rem;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.15);}
    .success-msg{background:linear-gradient(135deg,#22c55e,#16a34a);color:white;padding:.8rem;border-radius:.6rem;margin-bottom:1rem;text-align:center;}
  </style>
</head>
<body class="bg-slate-50 min-h-screen">

<!-- Header -->
<header class="bg-gradient-to-r from-purple-700 via-pink-600 to-yellow-500 shadow sticky top-0 z-40">
  <div class="max-w-5xl mx-auto px-3 py-3 flex items-center justify-between">
    <a href="index.html" class="title-3d">Talimi Ittehad</a>
    <nav class="flex gap-2 text-sm text-white">
      <a href="index.html" class="nav-link">ğŸ  Home</a>
      <a href="donation.html" class="nav-link nav-active">ğŸ’ Donate</a>
      <a href="admin-donations.html" class="nav-link">ğŸ‘‘ Admin</a>
    </nav>
  </div>
</header>

<!-- Main -->
<main class="max-w-2xl mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">ğŸ’ Support with Donation</h1>

  <!-- Success message (hidden by default) -->
  <div id="successBox" class="success-msg hidden">
    âœ… à¤†à¤ªà¤•à¤¾ payment à¤®à¤¿à¤² à¤—à¤¯à¤¾ à¤¹à¥ˆ, à¤¶à¥à¤•à¥à¤°à¤¿à¤¯à¤¾!
  </div>

  <!-- Donation Form -->
  <div class="card-3d">
    <h2 class="font-semibold mb-2">Fill your details</h2>
    <form id="donationForm" class="flex flex-col gap-3">
      <input type="text" id="name" placeholder="ğŸ‘¤ Your Name" class="border p-2 rounded" required />
      <input type="text" id="address" placeholder="ğŸ  Your Address" class="border p-2 rounded" required />
      <input type="number" id="amount" placeholder="ğŸ’° Amount (â‚¹)" class="border p-2 rounded" required />

      <!-- QR -->
      <div class="text-center">
        <p class="mb-2">ğŸ“² Pay on UPI (Scan QR)</p>
        <img id="qrImg" src="your-qr.png" class="mx-auto w-48 h-48 border rounded shadow" alt="QR Code" />
      </div>

      <!-- Screenshot Upload -->
      <div>
        <label class="block font-medium mb-1">ğŸ“¸ Upload Payment Screenshot</label>
        <input type="file" id="screenshot" accept="image/*" class="border p-2 rounded w-full" required />
      </div>

      <button type="submit" class="btn-3d">ğŸš€ Submit Donation</button>
    </form>
  </div>
</main>

<footer class="bg-gray-100 text-center py-4 mt-10">
  <p class="text-xs text-gray-500">Â© 2025 Talimi Ittehad</p>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "YOUR_FIREBASE_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const IMGBB_KEY = "d12c2e4a8650157b2b6b9fe85336ea43"; // ğŸ‘ˆ à¤†à¤ªà¤•à¤¾ ImgBB key

  const donationForm=document.getElementById("donationForm");
  const successBox=document.getElementById("successBox");

  let currentUser=null;

  // --- Auth ---
  onAuthStateChanged(auth,async user=>{
    if(user){
      currentUser=user;
      checkVerified();
    }else{
      // à¤…à¤—à¤° login à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ à¤¤à¥‹ auto login
      await signInWithPopup(auth,provider);
    }
  });

  // --- Check if donation verified ---
  async function checkVerified(){
    const q=query(collection(db,"donations"), where("uid","==",currentUser.uid));
    const snap=await getDocs(q);
    snap.forEach(d=>{
      if(d.data().verified){
        successBox.classList.remove("hidden");
        // scroll à¤ªà¤° hide à¤¹à¥‹ à¤œà¤¾à¤à¤—à¤¾
        window.addEventListener("scroll",()=>successBox.classList.add("hidden"),{once:true});
      }
    });
  }

  // Convert file to base64 for ImgBB
  function toBase64(file){
    return new Promise((resolve,reject)=>{
      const reader=new FileReader();
      reader.onload=()=>resolve(reader.result.split(",")[1]);
      reader.onerror=reject;
      reader.readAsDataURL(file);
    });
  }

  async function uploadToImgBB(file){
    const base64=await toBase64(file);
    const fd=new FormData();
    fd.append("image",base64);
    const res=await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{method:"POST",body:fd});
    const data=await res.json();
    if(data.success) return data.data.url;
    else throw new Error("ImgBB upload failed");
  }

  // --- Submit Donation ---
  donationForm.onsubmit=async e=>{
    e.preventDefault();
    const name=document.getElementById("name").value;
    const address=document.getElementById("address").value;
    const amount=document.getElementById("amount").value;
    const file=document.getElementById("screenshot").files[0];

    if(!file) return alert("Upload screenshot!");

    const screenshotUrl=await uploadToImgBB(file);

    await addDoc(collection(db,"donations"),{
      uid:currentUser.uid,
      name,address,amount,
      screenshot:screenshotUrl,
      verified:false,
      created:Date.now()
    });

    alert("âœ… Donation submitted! Admin verification pending.");
    donationForm.reset();
  };
</script>
</body>
</html>
