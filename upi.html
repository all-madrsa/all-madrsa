<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Talimi Ittehad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .title-3d{
      font-weight:700; font-size:2rem; color:#fff;
      text-shadow:2px 2px 8px rgba(0,0,0,.9);
    }
    .dropdown:hover .dropdown-menu{display:block;}
    .dropdown-menu{
      display:none; position:absolute; background:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,.2); border-radius:.5rem;
      min-width:160px; z-index:50;
    }
    .dropdown-menu a{display:block; padding:6px 12px; font-size:14px; color:#333;}
    .dropdown-menu a:hover{background:#f3f4f6;}
    .btn-3d{
      background:linear-gradient(90deg,#ff4d4d,#4dffb8,#4d94ff,#d24dff);
      box-shadow:0 4px 0 rgba(0,0,0,.25), 0 6px 12px rgba(0,0,0,.2);
      transition:transform .12s ease, box-shadow .12s ease;
      font-size:.75rem; padding:.25rem .6rem; color:#fff; font-weight:600; border-radius:6px;
      white-space:nowrap;
    }
    .btn-3d:active{transform:translateY(1px); box-shadow:0 2px 0 rgba(0,0,0,.25);}
    .carousel{position:relative; overflow:hidden; border-radius:.5rem;}
    .carousel-track{display:flex; transition:transform .6s ease-in-out;}
    .carousel img{width:100%; height:160px; object-fit:cover; flex-shrink:0;}
    marquee{background:#fff3cd; color:#856404; padding:6px; font-size:14px; border-bottom:1px solid #fcd34d;}
    .floating-donate {
      position: fixed;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 60;
      border-radius: 9999px;
      padding: .55rem .9rem;
    }
    /* Hide Google branding */
    .goog-logo-link, .goog-te-gadget span { display:none !important; }
    .goog-te-gadget { font-size:0 !important; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">


<!-- Header with Logo and 3D Buttons -->
<header class="bg-blue-600" style="height:100px;"> <!-- header height thoda kam kiya -->
  <div class="max-w-6xl mx-auto px-4 py-2 h-full flex flex-col justify-between">

    <!-- Top: 3D Buttons -->
   <div class="flex justify-center gap-4">
  <a href="nikah.html">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#ff4d4d,#ff914d);">💍 Nikah</button>
  </a>
  <a href="https://chatgpt.com/c/68d7e738-0a40-8325-9c70-1bf4977a00bf">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#4dffb8,#4d94ff);">📰 News</button>
  </a>
  <a href="hadees.html">
    <button class="btn-3d-special btn-small" style="background: linear-gradient(90deg,#d24dff,#ff4dd2);">📜 Hadees</button>
  </a>
</div>


    <!-- Middle: Logo and Side Images -->
    <div class="flex justify-between items-center h-full mt-1">

      <!-- Left: Makka -->
      <div class="flex items-center">
        <img src="makka.png" alt="Makka" class="header-png">
      </div>

    <!-- Center: Logo / Title -->
<div class="flex flex-col items-center justify-center h-full">
  <div class="text-white font-bold text-2xl" 
       style="text-shadow:2px 2px 8px rgba(0,0,0,.9); transform: translateY(-8px);">
    Talimi Ittehad
  </div>
</div>


      <!-- Right: Madina -->
      <div class="flex items-center">
        <img src="madina.png" alt="Madina" class="header-png">
      </div>

    </div>
  </div>
</header>

<style>
/* 3D Buttons Base */
.btn-3d-special {
  color: #fff;
  font-weight: 700;
  border-radius: 10px;
  box-shadow: 0 6px 0 rgba(0,0,0,.25), 0 8px 14px rgba(0,0,0,.25);
  transition: transform .12s ease, box-shadow .12s ease;
}
.btn-3d-special:active {
  transform: translateY(3px);
  box-shadow: 0 3px 0 rgba(0,0,0,.25);
}

/* Small variant for top header buttons */
.btn-small {
  font-size: 0.85rem;
  padding: 0.4rem 0.9rem;
}

/* Header PNG images */
.header-png {
  height: 70px;           /* image height */
  width: 70px;            /* image width */
  object-fit: cover;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>








<!-- Namaz Times Box -->
<div id="prayer-times" 
     class="bg-green-700 text-white text-xs sm:text-sm px-3 py-2 rounded shadow text-left leading-5 mt-2 sm:mt-0 sm:ml-4">
  🕌 Loading...
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ✅ Tumhara fixed timetable
  const timings = {
    "Fajr": "05:10",
    "Dhuhr": "12:20",
    "Asr": "04:00",
    "Maghrib": "06:15",
    "Isha": "07:45"
  };

  // ✅ Show times
  document.getElementById("prayer-times").innerHTML = `
    🌅 Fajr: ${timings.Fajr} &nbsp;|&nbsp;
    ☀ Dhuhr: ${timings.Dhuhr} &nbsp;|&nbsp;
    🌇 Asr: ${timings.Asr} &nbsp;|&nbsp;
    🌆 Maghrib: ${timings.Maghrib} &nbsp;|&nbsp;
    🌙 Isha: ${timings.Isha}
  `;
});
</script>


  
    <!-- Menu -->
    <div class="flex flex-wrap justify-center items-center gap-2 pb-2 text-xs sm:text-sm">
      <div class="dropdown relative">
        <button class="btn-3d">About ⬇</button>
        <div class="dropdown-menu">

          
          <a href="https://all-madrsa.netlify.app/about.html">About us</a>
          <a href="https://all-madrsa.netlify.app/mission.html">Mission</a>
          <a href="https://all-madrsa.netlify.app/contact.html">Contect</a>
          <a href="https://all-madrsa.netlify.app/privacy.html">Privacy policy</a>
           <a href="https://all-madrsa.netlify.app/gallery.html">Gallery</a>
          <a href="https://all-madrsa.netlify.app/terms.html">Terms & Conditions</a>

           <a href="#Youtube">Youtube</a>
           <a href="#Facbook">Facbook</a>
          <a href="#Instagrm">Instagrm</a>
 
          

          
        </div>
      </div>
      <div class="dropdown relative">
        <button class="btn-3d">More ⬇</button>
        <div class="dropdown-menu">
          <a href="https://all-madrsa.netlify.app/Calendar.html">Calendar</a>

           <a href="https://all-madrsa.netlify.app/founders.html">ALL INDIA MUSLIM PERSONAL BOARD</a>
          <a href="#faq">FAQ</a>
        </div>
      </div>

      <!-- 🌐 Translate Button -->
      <div class="relative flex flex-col items-center">
        <button id="langBtn" class="btn-3d">🌐 Select Language</button>
        <div id="google_translate_element" class="absolute top-full mt-2 hidden bg-white rounded shadow p-1 z-50 w-40 text-center"></div>
      </div>

      <!-- Auth + Add Button -->
      <button id="authBtn" class="btn-3d">Login</button>
      <button id="addBtn" class="btn-3d hidden">➕ Add Madarsa</button>
    </div>
  </div>
</header>

<body class="bg-slate-50 min-h-screen">

<!-- Header -->
<header class="bg-gradient-to-r from-purple-700 via-pink-600 to-yellow-500 shadow sticky top-0 z-40">
  <div class="max-w-5xl mx-auto px-3 py-3 flex items-center justify-between">
    <a href="index.html" class="title-3d">Talimi Ittehad</a>
    <nav class="flex gap-2 text-sm text-white">
      <a href="index.html">🏠 Home</a>
      <a href="https://all-madrsa.netlify.app/doner.html" class="font-bold underline">💝 Doner </a>
    </nav>
  </div>
</header>
  <!-- Left: Home Button -->
  <div>
 <a href="index.html" class="btn-3d-home px-1 py-0.5 text-xs rounded font-bold flex items-center justify-center">
  🏠 Home
</a>

  
</header>

<style>
/* 3D Button Style */
.btn-3d-home {
  background: linear-gradient(90deg,#ff4d4d,#4d94ff);
  color: white;
  font-weight: 700;
  box-shadow: 0 6px 0 rgba(0,0,0,0.25), 0 8px 14px rgba(0,0,0,0.25);
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}
.btn-3d-home:active {
  transform: translateY(3px);
  box-shadow: 0 3px 0 rgba(0,0,0,0.25);
}
</style>
<!-- Main -->
<main class="max-w-2xl mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">💝 Support with Donation</h1>

  <!-- Donation Form -->
  <div class="card-3d mb-6">
    <h2 class="font-semibold mb-2">Fill your details</h2>
    <form id="donationForm" class="flex flex-col gap-3">
      <input type="text" id="name" placeholder="👤 Your Name" class="border p-2 rounded" required />
      <input type="text" id="address" placeholder="🏠 Your Address" class="border p-2 rounded" required />
      <input type="number" id="amount" placeholder="💰 Amount (₹)" class="border p-2 rounded" required />

      <!-- QR + UPI -->
      <div class="text-center">
        <p class="mb-2">📲 Pay on UPI No. 8806940156 (Scan QR or Copy ID)</p>
        <img id="qrImg" src="" class="mx-auto w-48 h-48 border rounded shadow mb-2" alt="QR Code" />
        <p id="upiText" class="font-bold text-lg text-indigo-700"></p>

        <!-- ✅ New QR Download Button -->
        <div class="flex justify-center gap-2 mt-2">
          <button type="button" id="downloadQrBtn" class="btn-3d">⬇ QR Download</button>
        </div>
      </div>

      <!-- Screenshot Upload -->
      <div>
        <label class="block font-medium mb-1">📸 Upload Payment Screenshot</label>
        <input type="file" id="screenshot" accept="image/*" class="border p-2 rounded w-full" required />
      </div>

      <button type="submit" id="submitBtn" class="btn-3d">🚀 Submit Donation</button>
    </form>
  </div>

  <!-- User Donation List -->
  <div id="userDonationsList" class="card-3d mb-6 hidden"></div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="card-3d hidden">
    <h2 class="font-bold text-lg mb-3">👑 Admin - Donations List</h2>
    <div id="donationsList" class="space-y-3 mb-6"></div>

    <!-- QR + UPI Management -->
    <h2 class="font-bold text-lg mb-2">🔑 Manage QR & UPI</h2>
    <input type="file" id="qrUpload" accept="image/*" class="border p-2 rounded w-full mb-2" />
    <input type="text" id="upiInput" placeholder="Enter UPI ID" class="border p-2 rounded w-full mb-2" />
    <div class="flex gap-2">
      <button id="uploadQRBtn" class="btn-3d">⬆ Update</button>
      <button id="deleteQRBtn" class="btn-3d bg-red-600">🗑 Delete</button>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="bg-gray-100 text-center py-4 mt-10">
  <p class="text-xs text-gray-500">© 2025 Talimi Ittehad</p>
</footer>

<!-- Modal Popup -->
<div id="thankyouModal" class="modal hidden">
  <div class="modal-content">
    <h2 class="text-xl font-bold mb-2">✅ Payment Verified</h2>
    <p>अस्सलाम अलैकुम<br/>तालीमी इत्तेहाद में आपका दिया गया मदद मिल गया है 👍
 🤲</p>
    <button id="closeModal" class="btn-3d mt-4">❌ Close</button>
  </div>
</div>

<!-- Loud Notification Sound -->
<audio id="notifySound" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" preload="auto"></audio>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, getDocs, updateDoc, deleteDoc, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
    authDomain: "all-madrsa.firebaseapp.com",
    databaseURL: "https://all-madrsa-default-rtdb.firebaseio.com",
    projectId: "all-madrsa",
    storageBucket: "all-madrsa.appspot.com",
    messagingSenderId: "619313835874",
    appId: "1:619313835874:web:e387e1297663f11fc2463b"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // --- Config ---
  const ADMIN_EMAIL = "zaradigitalseva@gmail.com";
  const IMGBB_KEY = "d12c2e4a8650157b2b6b9fe85336ea43"; 

  // DOM Elements
  const donationForm=document.getElementById("donationForm");
  const submitBtn=document.getElementById("submitBtn");
  const qrImg=document.getElementById("qrImg");
  const upiText=document.getElementById("upiText");
  const copyUpiBtn=document.getElementById("copyUpiBtn");
  const adminPanel=document.getElementById("adminPanel");
  const donationsList=document.getElementById("donationsList");
  const thankyouModal=document.getElementById("thankyouModal");
  const closeModal=document.getElementById("closeModal");
  const userDonationsList=document.getElementById("userDonationsList");
  const downloadQrBtn=document.getElementById("downloadQrBtn"); // ✅ new

  let currentUser=null;
  let modalTimer=null;

  // --- Show Modal ---
  function showModal(){
    thankyouModal.classList.remove("hidden");
    const sound=document.getElementById("notifySound");
    sound.currentTime=0;
    sound.play().catch(err=>console.log("Autoplay blocked:",err));
    modalTimer=setTimeout(()=>thankyouModal.classList.add("hidden"),6000);
  }
  closeModal.onclick=()=>{
    thankyouModal.classList.add("hidden");
    if(modalTimer) clearTimeout(modalTimer);
  };

  // --- Auth ---
  onAuthStateChanged(auth,async user=>{
    if(user){
      currentUser=user;
      liveQR();
      liveDonationStatus();
      if(user.email===ADMIN_EMAIL){
        adminPanel.classList.remove("hidden");
        loadDonationsLive();
      }
    }else{
      await signInWithPopup(auth,provider);
    }
  });

  // --- Live Donation Status (user specific) ---
  function liveDonationStatus(){
    if(!currentUser) return;
    const q=query(collection(db,"donations"), where("uid","==",currentUser.uid));
    onSnapshot(q,snap=>{
      if(snap.empty) return;
      let html="<h3 class='font-bold mb-2'>📝 Your Donations</h3>";
      snap.forEach(d=>{
        const data=d.data();
        html+=`
          <div class="border rounded p-2 mb-2">
            <p><b>💰 ₹${data.amount}</b> - ${data.verified ? "✅ Verified" : "⏳ Pending"}</p>
            <img src="${data.screenshot}" class="w-32 mt-1 border rounded" />
          </div>`;
        if(data.verified){
          if(localStorage.getItem("lastVerified")!==d.id){
            localStorage.setItem("lastVerified",d.id);
            showModal();
          }
        }
      });
      userDonationsList.classList.remove("hidden");
      userDonationsList.innerHTML=html;
    });
  }

  // --- File to Base64 ---
  function toBase64(file){
    return new Promise((resolve,reject)=>{
      const reader=new FileReader();
      reader.onload=()=>resolve(reader.result.split(",")[1]);
      reader.onerror=reject;
      reader.readAsDataURL(file);
    });
  }

  // --- ImgBB Upload ---
  async function uploadToImgBB(file){
    const base64=await toBase64(file);
    const fd=new FormData();
    fd.append("image",base64);
    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {
      method: "POST",
      body: fd
    });

    const data=await res.json();
    if(data.success) return data.data.url;
    else throw new Error("ImgBB upload failed");
  }

  // --- Submit Donation ---
  donationForm.onsubmit=async e=>{
    e.preventDefault();
    if(!currentUser) return alert("Please login first!");

    submitBtn.disabled=true;
    submitBtn.textContent="⏳ Uploading...";

    const name=document.getElementById("name").value;
    const address=document.getElementById("address").value;
    const amount=document.getElementById("amount").value;
    const file=document.getElementById("screenshot").files[0];
    if(!file){
      alert("Upload screenshot!");
      submitBtn.disabled=false;
      submitBtn.textContent="🚀 Submit Donation";
      return;
    }

    try{
      const screenshotUrl=await uploadToImgBB(file);
      await addDoc(collection(db,"donations"),{
        uid:currentUser.uid,name,address,amount,
        screenshot:screenshotUrl,verified:false,created:Date.now()
      });
      alert("✅ Donation submitted! Awaiting admin verification.");
      donationForm.reset();
    }catch(err){
      alert("❌ Error: "+err.message);
    }finally{
      submitBtn.disabled=false;
      submitBtn.textContent="🚀 Submit Donation";
    }
  };

  // --- Load Donations (Admin - Live) ---
  function loadDonationsLive(){
    onSnapshot(collection(db,"donations"),snap=>{
      donationsList.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const div=document.createElement("div");
        div.className="border p-3 rounded shadow bg-white";
        div.innerHTML=`
          <p><b>👤 ${d.name}</b> (${d.address})</p>
          <p>💰 Amount: ₹${d.amount}</p>
          <img src="${d.screenshot}" class="w-40 my-2 border rounded shadow" />
          <p>Status: ${d.verified?"✅ Verified":"⏳ Pending"}</p>
          <div class="flex gap-2 mt-2">
            ${!d.verified ? `<button class="btn-3d verify">✅ Verify</button>` : ""}
            <button class="btn-3d delete">🗑 Delete</button>
          </div>`;
        if(!d.verified){
          div.querySelector(".verify").onclick=async()=>{
            await updateDoc(doc(db,"donations",docSnap.id),{verified:true});
            alert("✅ Donation verified!");
          };
        }
        div.querySelector(".delete").onclick=async()=>{
          if(confirm("Delete donation?")){
            await deleteDoc(doc(db,"donations",docSnap.id));
            alert("🗑 Donation deleted!");
          }
        };
        donationsList.appendChild(div);
      });
    });
  }

  // --- Live QR + UPI from Firestore ---
  function liveQR(){
    onSnapshot(doc(db,"config","qr"),snap=>{
      if(snap.exists()){
        const data=snap.data();
        qrImg.src=data.url||"https://via.placeholder.com/200?text=No+QR";
        upiText.textContent=data.upi||"";
      }else{
        qrImg.src="https://via.placeholder.com/200?text=No+QR";
        upiText.textContent="";
      }
    });
  }

  // --- Copy UPI ---
  // अगर copy button इस्तेमाल नहीं करना तो इसे remove कर सकते हो
  // अभी वही रहने दिया ताकि कुछ खराब न हो
  if(copyUpiBtn){
    copyUpiBtn.onclick=()=>{
      if(upiText.textContent){
        navigator.clipboard.writeText(upiText.textContent);
        alert("📋 Copied: "+upiText.textContent);
      }
    };
  }

  // --- Download QR ---
  downloadQrBtn.onclick=()=>{
    if(!qrImg.src) return alert("❌ QR not available!");
    const a=document.createElement("a");
    a.href=qrImg.src;
    a.download="talimi_ittehad_qr.png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  };

  // --- Admin QR + UPI Upload/Delete ---
  const qrUpload=document.getElementById("qrUpload");
  const upiInput=document.getElementById("upiInput");
  const uploadQRBtn=document.getElementById("uploadQRBtn");
  const deleteQRBtn=document.getElementById("deleteQRBtn");

  uploadQRBtn.onclick=async()=>{
    let url=null;
    if(qrUpload.files[0]) url=await uploadToImgBB(qrUpload.files[0]);
    const upi=upiInput.value;
    await setDoc(doc(db,"config","qr"),{url,upi});
    alert("✅ QR / UPI updated!");
    qrUpload.value=""; upiInput.value="";
  };

  deleteQRBtn.onclick=async()=>{
    if(confirm("Delete QR & UPI?")){
      await deleteDoc(doc(db,"config","qr"));
    }
  };
</script>
</body>
</html>
