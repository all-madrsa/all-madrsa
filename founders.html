<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All Members List | All India Muslim Personal Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f8f9fa;
    }

    /* HEADER */
    header {
      background: linear-gradient(90deg, #0077cc, #005fa3);
      color: white;
      text-align: center;
      padding: 10px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      position: relative;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: bold;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    }

    /* HOME BUTTON */
    .btn-3d-home {
      position: absolute;
      left: 10px;
      top: 10px;
      background: linear-gradient(90deg, #ff4d4d, #4d94ff);
      color: #fff;
      font-weight: bold;
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 8px;
      box-shadow: 0 5px 0 rgba(0,0,0,0.25), 0 8px 14px rgba(0,0,0,0.25);
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      text-decoration: none;
    }
    .btn-3d-home:active {
      transform: translateY(3px);
      box-shadow: 0 3px 0 rgba(0,0,0,0.25);
    }

    /* 3D Small Buttons */
    .btn-3d-special {
      color: #fff;
      font-weight: 700;
      border-radius: 10px;
      box-shadow: 0 6px 0 rgba(0,0,0,.25), 0 8px 14px rgba(0,0,0,.25);
      transition: transform .12s ease, box-shadow .12s ease;
      font-size: 0.85rem;
      padding: 0.4rem 0.9rem;
      border: none;
      cursor: pointer;
    }
    .btn-3d-special:active {
      transform: translateY(3px);
      box-shadow: 0 3px 0 rgba(0,0,0,.25);
    }

    .top-links {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    /* MEMBER LIST CONTAINER */
    main {
      max-width: 900px;
      margin: 20px auto;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    /* Responsive Grid for Member Cards */
    #members {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      justify-items: center;
    }

    @media (max-width: 600px) {
      #members {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 601px) {
      #members {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .member-card {
      background: #f0f8ff;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      transition: transform 0.2s;
    }

    .member-card:hover {
      transform: scale(1.05);
    }

    .member-card img {
      height: 100px;
      width: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 8px;
    }

    .member-card span {
      display: block;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .edit-btn, .delete-btn {
      border: none;
      color: white;
      padding: 5px 8px;
      border-radius: 6px;
      margin: 2px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .edit-btn { background: #28a745; }
    .delete-btn { background: #dc3545; }

    #memberForm {
      margin-top: 20px;
      display: none;
    }

    #memberForm input, #memberForm button {
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #msg {
      text-align: center;
      color: #444;
      font-weight: bold;
    }

    .donate-btn {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: linear-gradient(90deg, #ff5c8d, #ff9a3c);
      color: white;
      font-weight: bold;
      border-radius: 50px;
      padding: 10px 18px;
      text-decoration: none;
      box-shadow: 0 5px 10px rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>

  <header>
    <a href="index.html" class="btn-3d-home">üè† Home</a>
    <h1>All Members List</h1>

    <div class="top-links">
      <a href="nikah.html"><button class="btn-3d-special" style="background: linear-gradient(90deg,#ff4d4d,#ff914d);">üíç Nikah</button></a>
      <a href="news.html"><button class="btn-3d-special" style="background: linear-gradient(90deg,#4dffb8,#4d94ff);">üì∞ News</button></a>
      <a href="hadees.html"><button class="btn-3d-special" style="background: linear-gradient(90deg,#d24dff,#ff4dd2);">üìú Hadees</button></a>
    </div>
  </header>

  <main>
    <div id="members"></div>
    <p id="msg"></p>

    <form id="memberForm">
      <h3>Add Member</h3>
      <input type="text" id="name" placeholder="Member Name" required>
      <input type="file" id="photoFile" accept="image/*" required>
      <button type="button" onclick="addMember()">Add Member</button>
    </form>
  </main>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
      authDomain: "all-madrasa.firebaseapp.com",
      projectId: "all-madrsa",
      storageBucket: "all-madrsa.appspot.com",
      messagingSenderId: "619313835874",
      appId: "1:619313835874:web:e387e1297663f11fc2463b"
    };
    const imgbbKey = "d12c2e4a8650157b2b6b9fe85336ea43";

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const adminEmails = ["zaradigitalseva@gmail.com", "secondadmin@gmail.com"];

    const membersContainer = document.getElementById("members");
    const memberForm = document.getElementById("memberForm");
    const msg = document.getElementById("msg");

    // Load Members
    function loadMembers() {
      db.collection("members").orderBy("name").onSnapshot(snapshot => {
        membersContainer.innerHTML = "";
        snapshot.forEach(doc => {
          let m = doc.data();
          let card = document.createElement("div");
          card.className = "member-card";

          let img = document.createElement("img");
          img.src = m.photo;
          img.alt = m.name;

          let span = document.createElement("span");
          span.textContent = m.name;

          card.appendChild(img);
          card.appendChild(span);

          auth.onAuthStateChanged(user => {
            if (user && adminEmails.includes(user.email)) {
              let editBtn = document.createElement("button");
              editBtn.textContent = "‚úèÔ∏è Edit";
              editBtn.className = "edit-btn";
              editBtn.onclick = () => editMember(doc.id, m.name);

              let delBtn = document.createElement("button");
              delBtn.textContent = "üóë Delete";
              delBtn.className = "delete-btn";
              delBtn.onclick = () => deleteMember(doc.id);

              card.appendChild(editBtn);
              card.appendChild(delBtn);
            }
          });

          membersContainer.appendChild(card);
        });
      });
    }
    loadMembers();

    // Login Check
    auth.onAuthStateChanged(user => {
      if (user) {
        if (adminEmails.includes(user.email)) {
          memberForm.style.display = "block";
          msg.innerText = "";
        } else {
          memberForm.style.display = "none";
          msg.innerText = "‡§Ü‡§™ ‡§≠‡•Ä ‡§ú‡•Å‡§°‡§º‡•á‡§Ç ‡§Ü‡§ú ‡§π‡•Ä ‡§î‡§∞ ‡§Ö‡§≠‡•Ä‡•§";
        }
      } else {
        msg.innerText = "";
      }
    });

    async function uploadToImgbb(file) {
      const formData = new FormData();
      formData.append("image", file);
      try {
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
          method: "POST",
          body: formData,
          headers: { Accept: "application/json" }
        });
        const result = await response.json();
        if (!result.success) {
          alert("‚ùå Image upload failed. Please try again.");
          return null;
        }
        return result.data.url;
      } catch (err) {
        alert("‚ö†Ô∏è Network issue: Unable to upload image.");
        return null;
      }
    }

    async function addMember() {
      let name = document.getElementById("name").value.trim();
      let file = document.getElementById("photoFile").files[0];
      if (!file) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"); return; }

      const photoUrl = await uploadToImgbb(file);
      if (!photoUrl) return;

      db.collection("members").add({ name, photo: photoUrl })
        .then(() => document.getElementById("memberForm").reset())
        .catch(err => alert("Error: " + err.message));
    }

    function editMember(id, oldName) {
      let newName = prompt("Update Name:", oldName);
      if (!newName) return;
      db.collection("members").doc(id).update({ name: newName })
        .then(() => alert("‚úÖ Name updated!"))
        .catch(err => alert("Error: " + err.message));
    }

    function deleteMember(id) {
      if (confirm("Are you sure you want to delete this member?")) {
        db.collection("members").doc(id).delete()
          .then(() => alert("‚úÖ Member deleted!"))
          .catch(err => alert("Error: " + err.message));
      }
    }
  </script>

  <a href="https://all-madrsa.netlify.app/upi" class="donate-btn">üíù Donate</a>

</body>
</html>
