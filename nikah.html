<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nikah Portal</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {background:#fdf6e3; font-family:sans-serif;}
.card-text{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.btn-3d {
  background: linear-gradient(90deg,#ff4d4d,#4d94ff);
  color: white; font-weight:700;
  box-shadow:0 6px 0 rgba(0,0,0,0.25),0 8px 14px rgba(0,0,0,0.25);
  transition:transform .1s, box-shadow .1s, background .3s;
}
.btn-3d:hover {background: linear-gradient(90deg,#ff6666,#66a3ff);}
.btn-3d:active {transform: translateY(3px); box-shadow:0 3px 0 rgba(0,0,0,0.25);}
</style>
</head>
<body class="text-black">

<header class="bg-blue-600 p-4 flex justify-between items-center text-white">
  <h1 class="text-2xl font-bold">Nikah Portal</h1>
  <div class="flex gap-2 items-center">
    <a href="index.html" class="btn-3d px-3 py-1 text-sm rounded font-bold flex items-center justify-center">ğŸ  Home</a>
  </div>
</header>

<section class="p-4 flex gap-2 flex-wrap">
  <select id="filterGender" class="border p-2 rounded">
    <option value="all">All Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>
  <select id="filterMarital" class="border p-2 rounded">
    <option value="all">All Marital</option>
    <option value="Single">Single</option>
    <option value="Divorced">Divorced</option>
    <option value="Widow/Widower">Widow/Widower</option>
  </select>
  <input type="number" id="filterAge" class="border p-2 rounded" placeholder="Age">
  <button id="filterBtn" class="bg-blue-500 text-white px-3 py-1 rounded">Search</button>
</section>

<main id="postsList" class="p-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-4"></main>

<div id="popup" class="fixed top-0 left-0 right-0 bottom-0 hidden bg-black/70 flex items-center justify-center z-50">
  <div class="bg-white rounded p-4 max-w-md w-11/12 max-h-[90vh] overflow-y-auto relative">
    <button id="closePopup" class="absolute top-2 right-2 bg-red-500 px-2 py-1 rounded text-white">âŒ</button>
    <div id="popupContent" class="space-y-2"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, query, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain: "all-madrsa.firebaseapp.com",
  projectId: "all-madrsa",
  storageBucket: "all-madrsa.appspot.com",
  messagingSenderId: "619313835874",
  appId: "1:619313835874:web:e387e1297663f11fc2463b"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore();

const postsList = document.getElementById("postsList");
const popup = document.getElementById("popup");
const popupContent = document.getElementById("popupContent");
const closePopup = document.getElementById("closePopup");

let allProfiles = [];

// Fetch profiles
const q = query(collection(db, "profiles"), orderBy("created", "desc"));
onSnapshot(q, snapshot => {
  allProfiles = [];
  snapshot.forEach(docSnap => {
    let data = docSnap.data();
    data.id = docSnap.id;
    allProfiles.push(data);
  });
  renderProfiles(allProfiles);
});

// Render profiles
function renderProfiles(profiles, filters={}) {
  postsList.innerHTML = "";
  let filtered = profiles.filter(p => {
    if(!p.approvals) return false;
    const approved = Object.values(p.approvals).some(v => v);
    if(!approved) return false;
    if(filters.gender && filters.gender !== "all" && p.gender !== filters.gender) return false;
    if(filters.marital && filters.marital !== "all" && p.marital !== filters.marital) return false;
    if(filters.age && p.age != filters.age) return false;
    return true;
  });

  filtered.forEach(p => {
    const imgSrc = p.approvals.photoUrl && p.photoUrl ? p.photoUrl : "https://via.placeholder.com/150?text=No+Image";
    const nameAge = `${p.approvals.name ? p.name : "No Name"} / ${p.approvals.age ? p.age : "NA"}`;
    
    const card = document.createElement("div");
    card.className = "cursor-pointer flex flex-col items-center bg-white rounded shadow p-2";
    card.innerHTML = `
      <img src="${imgSrc}" class="w-32 h-32 object-cover rounded mb-1">
      <p class="text-center font-semibold text-sm">${nameAge}</p>
    `;
    card.onclick = () => showPopup(p);
    postsList.appendChild(card);
  });
}

// Popup
function showPopup(profile) {
  let html = "";
  html += `<img src="${profile.photoUrl || 'https://via.placeholder.com/300?text=No+Image'}" class="w-full h-64 object-cover rounded">`;
  html += `<p>ğŸ‘¤ Name: ${profile.name || "NA"}</p>`;
  html += `<p>ğŸ‚ Age: ${profile.age || "NA"}</p>`;
  html += `<p>ğŸ“± WhatsApp: ${profile.whatsapp || "NA"}</p>`;
  html += `<p>ğŸš» Gender: ${profile.gender || "NA"}</p>`;
  html += `<p>ğŸ“ Education: ${profile.education || "NA"}</p>`;
  html += `<p>ğŸ’¼ Profession: ${profile.profession || "NA"}</p>`;
  html += `<p>ğŸ’° Income: ${profile.income || "NA"}</p>`;
  html += `<p>ğŸ“Œ Marital Status: ${profile.marital || "NA"}</p>`;
  html += `<p>ğŸ•Œ Religion: ${profile.religion || "NA"}</p>`;
  html += `<p>ğŸª§ Caste: ${profile.caste || "NA"}</p>`;
  html += `<p>ğŸ™ï¸ City: ${profile.city || "NA"}</p>`;
  popupContent.innerHTML = html;
  popup.classList.remove("hidden");
}

closePopup.onclick = () => popup.classList.add("hidden");

// Filters
document.getElementById("filterBtn").onclick = () => {
  const gender = document.getElementById("filterGender").value;
  const marital = document.getElementById("filterMarital").value;
  const age = document.getElementById("filterAge").value.trim();
  renderProfiles(allProfiles, {gender, marital, age});
};
</script>

</body>
</html>
