<!-- Notice Bar -->
<div id="noticeBar" class="w-full bg-yellow-200 py-1 overflow-hidden relative">
  <div id="noticeScroll" class="flex whitespace-nowrap items-center gap-4"></div>
</div>

<!-- Admin Notice Editor -->
<div id="noticeAdmin" class="hidden max-w-6xl mx-auto px-4 mt-2 space-y-2">
  <textarea id="noticeInput" class="border p-2 w-full rounded text-sm" placeholder="Add new notice..."></textarea>
  <button id="saveNotice" class="btn-3d bg-blue-600 text-white px-4 py-2 rounded">ðŸ’¾ Add Notice</button>
</div>

<style>
/* Scroll animation */
@keyframes scroll-left {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}
#noticeScroll {
  display: inline-flex;
  animation: scroll-left linear infinite;
  animation-duration: 25s; /* Adjust speed */
}
.notice-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #facc15; /* yellow-400 */
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1rem;
}
.notice-btn {
  padding: 2px 5px;
  font-size: 0.75rem;
  border-radius: 4px;
  cursor: pointer;
  color: #fff;
}
.notice-edit { background: #1d4ed8; }
.notice-delete { background: #dc2626; }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  databaseURL:"https://all-madrsa-default-rtdb.firebaseio.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e387e1297663b11fc2463b"
};
const ADMIN_EMAIL = "zaradigitalseva@gmail.com";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const noticeScroll = document.getElementById("noticeScroll");
const noticeAdmin = document.getElementById("noticeAdmin");
const noticeInput = document.getElementById("noticeInput");
const saveNotice = document.getElementById("saveNotice");

let currentUser = null;

// Load all notices
async function loadNotices() {
  noticeScroll.innerHTML = "";
  try {
    const q = query(collection(db,"notices"), orderBy("createdAt","desc"));
    const snap = await getDocs(q);
    if(snap.empty){
      const span = document.createElement("span");
      span.className="notice-item";
      span.textContent = "ðŸ“¢ Welcome to Talimi Ittehad!";
      noticeScroll.appendChild(span);
      return;
    }
    snap.forEach(docSnap=>{
      const d = docSnap.data();
      const span = document.createElement("span");
      span.className="notice-item";
      span.textContent = d.text;

      if(currentUser?.email === ADMIN_EMAIL){
        const editBtn = document.createElement("button");
        editBtn.textContent="âœï¸";
        editBtn.className="notice-btn notice-edit";
        editBtn.onclick = async()=>{
          const newText = prompt("Update notice text:", d.text);
          if(newText){
            await updateDoc(doc(db,"notices",docSnap.id),{text:newText});
            loadNotices();
          }
        };
        const delBtn = document.createElement("button");
        delBtn.textContent="ðŸ—‘";
        delBtn.className="notice-btn notice-delete";
        delBtn.onclick = async()=>{
          if(confirm("Delete this notice?")){
            await deleteDoc(doc(db,"notices",docSnap.id));
            loadNotices();
          }
        };
        span.appendChild(editBtn);
        span.appendChild(delBtn);
      }

      noticeScroll.appendChild(span);
    });
  } catch(e){
    console.error(e);
    const span = document.createElement("span");
    span.className="notice-item";
    span.textContent="âš ï¸ Failed to load notices";
    noticeScroll.appendChild(span);
  }
}

// Save notice (Admin)
saveNotice.onclick = async()=>{
  const text = noticeInput.value.trim();
  if(!text) return alert("Enter notice text");
  await addDoc(collection(db,"notices"),{text, createdAt:serverTimestamp()});
  noticeInput.value="";
  loadNotices();
};

// Auth check
onAuthStateChanged(auth,user=>{
  currentUser = user;
  if(user?.email===ADMIN_EMAIL){
    noticeAdmin.classList.remove("hidden");
  } else {
    noticeAdmin.classList.add("hidden");
  }
  loadNotices();
});

// Initial load
loadNotices();
</script>
