<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All India Muslim Personal Board</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a2e0a2a0b1.js" crossorigin="anonymous"></script>
  <style>
    body { background: linear-gradient(135deg,#f0f4f8,#dfe9f3); min-height:100vh; }
    header {
      background: linear-gradient(90deg,#004080,#0066cc);
      color: white; padding: 15px; text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }
    .glass-card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      border-radius: 12px;
    }
    .btn-3d-home {
      background: linear-gradient(90deg,#ff4d4d,#4d94ff);
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 0 rgba(0,0,0,0.25), 0 8px 14px rgba(0,0,0,0.25);
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 8px;
      margin: 15px;
    }
    .btn-3d-home:active {
      transform: translateY(3px);
      box-shadow: 0 3px 0 rgba(0,0,0,0.25);
    }
  </style>
</head>
<body>

<header>
  <h1 class="text-2xl font-bold">All Members List</h1>
</header>

<!-- Home Button -->
<div class="flex justify-center">
  <a href="index.html" class="btn-3d-home">üè† Home</a>
</div>

<main class="max-w-4xl mx-auto px-4 pb-20">
  <h2 class="text-xl font-bold mb-4 text-center">üë• Members Directory</h2>
  
  <!-- Login Button -->
  <div class="flex justify-center mb-4">
    <button id="loginBtn" onclick="googleLogin()" 
      class="flex items-center gap-2 bg-white border px-4 py-2 rounded shadow hover:bg-gray-100 transition">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt="G" class="w-5 h-5">
      <span>Sign in with Google</span>
    </button>
  </div>
  <p id="msg" class="text-center text-red-600 font-medium mb-4"></p>

  <!-- Members List -->
  <div id="members" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

  <!-- Add Member Form -->
  <form id="memberForm" class="glass-card p-4 mt-6 hidden">
    <h3 class="text-lg font-semibold mb-2">‚ûï Add New Member</h3>
    <input type="text" id="name" placeholder="Member Name" required class="border p-2 rounded w-full mb-2">
    <input type="file" id="photoFile" accept="image/*" required class="border p-2 rounded w-full mb-3">
    <button type="button" onclick="addMember()" class="bg-blue-600 text-white px-4 py-2 rounded w-full hover:bg-blue-700">
      Save Member
    </button>
  </form>
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
    authDomain: "all-madrasa.firebaseapp.com",
    projectId: "all-madrsa",
    storageBucket: "all-madrsa.appspot.com",
    messagingSenderId: "619313835874",
    appId: "1:619313835874:web:e387e1297663f11fc2463b"
  };
  const imgbbKey = "d12c2e4a8650157b2b6b9fe85336ea43";
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const adminEmails = ["zaradigitalseva@gmail.com","secondadmin@gmail.com"];
  const membersContainer = document.getElementById("members");
  const loginBtn = document.getElementById("loginBtn");
  const memberForm = document.getElementById("memberForm");
  const msg = document.getElementById("msg");

  function loadMembers() {
    db.collection("members").orderBy("name").onSnapshot(snapshot => {
      membersContainer.innerHTML = "";
      snapshot.forEach(doc => {
        let m = doc.data();
        let card = document.createElement("div");
        card.className = "glass-card p-4 flex flex-col items-center text-center";

        let img = document.createElement("img");
        img.src = m.photo;
        img.alt = m.name;
        img.className = "w-24 h-24 rounded-full object-cover mb-2 shadow";

        let nameEl = document.createElement("p");
        nameEl.textContent = m.name;
        nameEl.className = "font-semibold text-lg";

        card.appendChild(img);
        card.appendChild(nameEl);

        auth.onAuthStateChanged(user => {
          if (user && adminEmails.includes(user.email)) {
            let btnBox = document.createElement("div");
            btnBox.className = "mt-2 flex gap-2";

            let editBtn = document.createElement("button");
            editBtn.innerHTML = '<i class="fas fa-edit"></i>';
            editBtn.className = "bg-yellow-400 px-3 py-1 rounded text-black hover:bg-yellow-500";
            editBtn.onclick = () => editMember(doc.id, m.name, m.photo);

            let delBtn = document.createElement("button");
            delBtn.innerHTML = '<i class="fas fa-trash"></i>';
            delBtn.className = "bg-red-500 px-3 py-1 rounded text-white hover:bg-red-600";
            delBtn.onclick = () => deleteMember(doc.id);

            btnBox.appendChild(editBtn);
            btnBox.appendChild(delBtn);
            card.appendChild(btnBox);
          }
        });

        membersContainer.appendChild(card);
      });
    });
  }
  loadMembers();

  auth.onAuthStateChanged(user => {
    if (user) {
      if (adminEmails.includes(user.email)) {
        loginBtn.style.display = "none";
        memberForm.style.display = "block";
        msg.innerText = "";
      } else {
        loginBtn.style.display = "none";
        memberForm.style.display = "none";
        msg.innerText = "üôè Welcome! ‡§Ü‡§™ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§";
      }
    } else {
      loginBtn.style.display = "block";
      memberForm.style.display = "none";
      msg.innerText = "";
    }
  });

  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(err => alert("Login Failed: "+err.message));
  }

  async function uploadImage(file) {
    let formData = new FormData();
    formData.append("image", file);
    let res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
      method: "POST",
      body: formData
    });
    let data = await res.json();
    return data.data.url;
  }

  async function addMember() {
    let name = document.getElementById("name").value;
    let file = document.getElementById("photoFile").files[0];
    if(!file){ alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"); return; }
    let photoUrl = await uploadImage(file);
    db.collection("members").add({name, photo: photoUrl})
      .then(()=> document.getElementById("memberForm").reset())
      .catch(err=>alert("Error: "+err.message));
  }

  function editMember(id, oldName, oldPhoto){
    let newName = prompt("Update Name:", oldName);
    if(!newName) return;
    db.collection("members").doc(id).update({name: newName})
      .then(()=>alert("‚úÖ Name updated!"))
      .catch(err=>alert("Error: "+err.message));
  }

  function deleteMember(id){
    if(confirm("Are you sure you want to delete this member?")){
      db.collection("members").doc(id).delete()
        .then(()=>alert("‚úÖ Member deleted!"))
        .catch(err=>alert("Error: "+err.message));
    }
  }
</script>

<!-- Fixed Donate Button -->
<a href="https://all-madrsa.netlify.app/upi" 
   class="fixed top-1/2 right-4 transform -translate-y-1/2 
          bg-yellow-400 text-black font-bold px-5 py-3 
          rounded-lg shadow-lg hover:bg-yellow-300 z-50">
   üíù Donate
</a>

</body>
</html>
