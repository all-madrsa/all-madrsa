<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Talimi Ittehad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .title-3d { font-weight:bold; font-size:1.8rem; color:white; text-shadow:2px 2px 8px rgba(0,0,0,0.9); }
    .dropdown:hover .dropdown-menu { display:block; }
    .dropdown-menu { display:none; position:absolute; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.2); border-radius:0.5rem; min-width:160px; z-index:50; }
    .dropdown-menu a { display:block; padding:6px 12px; font-size:14px; color:#333; }
    .dropdown-menu a:hover { background:#f3f4f6; }
    .btn-3d {
      background: linear-gradient(90deg,#ff4d4d,#4dffb8,#4d94ff,#d24dff);
      box-shadow: 0 4px 0 rgba(0,0,0,0.25), 0 6px 12px rgba(0,0,0,0.2);
      transition: transform .12s ease, box-shadow .12s ease;
      font-size: 0.85rem; padding: 0.35rem 0.7rem; color: white; font-weight: 600; border-radius: 6px;
    }
    .btn-3d:active { transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.25); }
    .carousel { position: relative; overflow: hidden; }
    .carousel-track { display: flex; transition: transform 0.6s ease-in-out; }
    .carousel img { width: 100%; height: 160px; object-fit: cover; flex-shrink: 0; }
    marquee { font-weight:600; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">

<!-- Header -->
<header class="bg-gradient-to-r from-purple-700 via-pink-600 to-yellow-500 shadow sticky top-0 z-40">
  <div class="max-w-6xl mx-auto flex flex-col">
    <div class="flex items-center justify-between px-4 py-2">
      <div class="title-3d">Talimi Ittehad</div>
      <div class="flex items-center gap-3">

        <!-- Dropdown Menus -->
        <div class="dropdown relative">
          <button class="btn-3d">About ‚¨á</button>
          <div class="dropdown-menu">
            <a href="#">‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç</a>
            <a href="#">‡§Æ‡§ø‡§∂‡§®</a>
          </div>
        </div>
        <div class="dropdown relative">
          <button class="btn-3d">More ‚¨á</button>
          <div class="dropdown-menu">
            <a href="#">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç</a>
            <a href="#">FAQ</a>
          </div>
        </div>

        <!-- Donation Button -->
        <button class="btn-3d">üôè Donate</button>

        <!-- Auth Buttons -->
        <button id="authBtn" class="btn-3d">Login</button>
      </div>
    </div>
  </div>
</header>

<!-- Notice -->
<div class="bg-yellow-100 text-red-600 py-1 text-sm">
  <marquee id="noticeText">üì¢ Welcome to Talimi Ittehad website</marquee>
</div>

<!-- Admin notice edit -->
<div id="noticeAdmin" class="hidden max-w-6xl mx-auto mt-2 px-4">
  <input id="noticeInput" placeholder="Type scrolling notice..." class="border p-2 rounded w-2/3"/>
  <button id="noticeSave" class="btn-3d">Save Notice</button>
</div>

<!-- Search Box -->
<div class="max-w-6xl mx-auto px-4 mt-3">
  <input id="searchInput" placeholder="Search Madarsa..." class="w-full border p-2 rounded"/>
</div>

<!-- Main content -->
<main class="max-w-6xl mx-auto p-4">
  <div id="list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</main>

<!-- Google Translate -->
<footer class="bg-gray-100 py-4 mt-6">
  <div id="google_translate_element" class="text-center"></div>
</footer>

<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({pageLanguage: 'hi'}, 'google_translate_element');
  }
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<!-- Firebase + JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
    authDomain: "all-madrsa.firebaseapp.com",
    projectId: "all-madrsa",
    storageBucket: "all-madrsa.appspot.com",
    messagingSenderId: "619313835874",
    appId: "1:619313835874:web:e387e1297663f11fc2463b"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const ADMIN_EMAIL = "zaradigitalseva@gmail.com";
  const authBtn = document.getElementById("authBtn");
  const noticeText = document.getElementById("noticeText");
  const noticeInput = document.getElementById("noticeInput");
  const noticeSave = document.getElementById("noticeSave");
  const noticeAdmin = document.getElementById("noticeAdmin");

  // Auth
  authBtn.onclick = async()=>{ 
    if(!auth.currentUser) await signInWithPopup(auth,provider); 
    else await signOut(auth); 
  };

  onAuthStateChanged(auth, async(user)=>{
    if(user && user.email===ADMIN_EMAIL){ 
      authBtn.textContent="Logout"; 
      noticeAdmin.classList.remove("hidden");
      const snap = await getDoc(doc(db,"config","notice"));
      if(snap.exists()) noticeText.textContent = snap.data().text;
    } else {
      authBtn.textContent="Login"; 
      noticeAdmin.classList.add("hidden");
    }
  });

  noticeSave.onclick = async()=>{
    const text = noticeInput.value.trim();
    if(!text) return;
    await setDoc(doc(db,"config","notice"), {text});
    noticeText.textContent = text;
    alert("‚úÖ Notice updated!");
  }

  // ============================
  // üîé Firestore Listing + Live Search
  // ============================

  const listBox = document.getElementById("list");
  const searchInput = document.getElementById("searchInput");

  let allMadarse = []; // cache

  async function loadMadarse() {
    listBox.innerHTML = `<p class="col-span-full text-center text-gray-500">‚è≥ Loading...</p>`;
    const snap = await getDocs(collection(db,"madarse"));
    allMadarse = [];
    snap.forEach(docSnap => {
      allMadarse.push({id:docSnap.id, ...docSnap.data()});
    });
    renderMadarse(allMadarse);
  }

  function renderMadarse(items){
    if(items.length===0){
      listBox.innerHTML = `<p class="col-span-full text-center text-gray-500">üòî ‡§ï‡•ã‡§à ‡§∞‡§ø‡§ú‡§º‡§≤‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>`;
      return;
    }
    listBox.innerHTML = "";
    items.forEach(m=>{
      const card = document.createElement("div");
      card.className = "bg-white shadow rounded-lg overflow-hidden border";

      card.innerHTML = `
        <div class="carousel relative">
          <div class="carousel-track">
            ${(m.images || []).map(url=>`<img src="${url}" alt="">`).join("")}
          </div>
        </div>
        <div class="p-3">
          <h4 class="font-bold text-lg text-indigo-600">${m.name||""}</h4>
          <p class="text-gray-600 text-sm">${m.address||""}</p>
          <p class="text-sm text-gray-500">üìû ${m.contact||""}</p>
          ${m.about ? `<p class="mt-1 text-gray-700 text-sm">${m.about}</p>` : ""}
          ${m.upi ? `<img src="${m.upi}" alt="UPI QR" class="mt-2 w-28 h-28">` : ""}
        </div>
      `;
      listBox.appendChild(card);
    });
  }

  // üîé Live search (‡§π‡§∞ typing ‡§™‡§∞ filter)
  searchInput.addEventListener("input",()=>{
    const q = searchInput.value.trim().toLowerCase();
    if(!q) renderMadarse(allMadarse);
    else {
      const filtered = allMadarse.filter(m=>
        (m.name && m.name.toLowerCase().includes(q)) ||
        (m.address && m.address.toLowerCase().includes(q)) ||
        (m.courses && m.courses.toLowerCase().includes(q))
      );
      renderMadarse(filtered);
    }
  });

  // Load all on page start
  loadMadarse();
</script>
</body>
</html>
