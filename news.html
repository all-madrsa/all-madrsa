<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>News Portal</title>
<style>
:root{
  --green:#116530;
  --accent:#008069;
  --muted:#777;
  --card-radius:12px;
  --card-h:250px;
}
body { font-family:"Segoe UI", sans-serif; margin:0; background:#f5f7f5; color:#222; }

/* HEADER */
.site-header{
  position:sticky; top:0; z-index:60;
  background: linear-gradient(135deg,#6ec1ff,#3aa8ff);
  padding:10px;
  text-align:center;
  color:#fff;
  font-weight:700;
}
.button-row{
  display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:8px;
}
.header-btn{
  background:#fff; color:#0b63a6; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700;
}
.header-btn:hover{ filter:brightness(0.95); }

/* MAIN */
main { max-width:1024px; margin:20px auto; padding:0 10px; }

/* grid cards */
.grid { display:grid; gap:14px; grid-template-columns:1fr; }
@media(min-width:600px){ .grid { grid-template-columns:repeat(2,1fr); } }
@media(min-width:900px){ .grid { grid-template-columns:repeat(3,1fr); } }

.card { background:white; border-radius:var(--card-radius); overflow:hidden; height:var(--card-h); display:flex; flex-direction:column; box-shadow:0 4px 12px rgba(0,0,0,0.1); cursor:pointer; transition:transform 0.2s; }
.card:hover { transform:translateY(-4px); }
.card img { width:100%; height:120px; object-fit:cover; }
.card-body { padding:8px; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
.card-body h3 { margin:0; font-size:16px; color:var(--green); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.card-body p { margin:4px 0 0 0; font-size:14px; color:#555; overflow:hidden; text-overflow:ellipsis; }
.card-footer { padding:6px 8px; display:flex; gap:6px; flex-wrap:wrap; }

/* admin buttons */
.admin-small { background:#ffc107; color:#333; border:none; border-radius:6px; padding:4px 6px; cursor:pointer; font-size:12px; }
.admin-del { background:#dc3545; color:#fff; border:none; border-radius:6px; padding:4px 6px; cursor:pointer; font-size:12px; }

/* popup */
#newsPopup { position:fixed; inset:0; display:none; justify-content:center; align-items:center; background:rgba(0,0,0,0.6); z-index:100; padding:10px; overflow:auto; }
.news-card { background:white; width:100%; max-width:800px; border-radius:12px; padding:16px; box-shadow:0 10px 40px rgba(0,0,0,0.25); position:relative; }
.news-card img { width:100%; max-height:400px; object-fit:cover; border-radius:8px; margin-bottom:10px; }
.close-btn { position:absolute; top:10px; right:10px; background:#eee; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }

/* admin form */
#adminForm { display:none; background:white; padding:16px; border-radius:12px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
#adminForm input, #adminForm textarea { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #ddd; }
#adminForm button { background:var(--accent); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; margin-top:6px; }

/* responsive */
@media(max-width:420px){ .card-body h3 { font-size:14px; } }
</style>
</head>
<body>

<header class="site-header">
  न्यूज़ पोर्टल
  <div class="button-row">
    <button class="header-btn" id="loginBtn" onclick="login()">Admin Login</button>
    <button class="header-btn" id="logoutBtn" onclick="logout()" style="display:none">Logout</button>
  </div>
</header>

<main>
  <section id="adminForm">
    <h3>News Post (Admin)</h3>
    <input type="hidden" id="editId">
    <input type="text" id="title" placeholder="Title">
    <textarea id="content" placeholder="Full Content"></textarea>
    <input type="file" id="imageFile" accept="image/*">
    <button onclick="saveNews()">Save News</button>
  </section>

  <div class="grid" id="newsGrid">
    <!-- Cards loaded via JS -->
  </div>
</main>

<!-- News Popup -->
<div id="newsPopup">
  <div class="news-card">
    <button class="close-btn" onclick="closePopup()">❌</button>
    <img id="popupImage" src="">
    <h2 id="popupTitle"></h2>
    <p id="popupContent"></p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e387e1297663b11fc2463b11fc2463b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

const ADMIN_EMAIL = "zaradigitalseva@gmail.com";
const IMGBB_API_KEY = "YOUR_IMGBB_API_KEY"; // replace with your Imgbb key

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const newsGrid = document.getElementById('newsGrid');

auth.onAuthStateChanged(user=>{
  if(user && user.email===ADMIN_EMAIL){
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-block';
    document.getElementById('adminForm').style.display='block';
  } else{
    loginBtn.style.display='inline-block';
    logoutBtn.style.display='none';
    document.getElementById('adminForm').style.display='none';
  }
});

function login(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}
function logout(){ auth.signOut(); }

// Load news cards
function loadNews(){
  db.collection('news').orderBy('title').onSnapshot(snapshot=>{
    newsGrid.innerHTML='';
    snapshot.forEach(doc=>{
      const data = doc.data();
      const card = document.createElement('div'); card.className='card';
      card.innerHTML=`
        <img src="${data.image}" alt="${data.title}">
        <div class="card-body">
          <h3>${data.title}</h3>
          <p>${data.content.substring(0,80)}...</p>
        </div>
        <div class="card-footer">
          <button onclick="openPopup('${doc.id}')">Read More</button>
          ${auth.currentUser && auth.currentUser.email===ADMIN_EMAIL ? `
          <button class="admin-small" onclick="editNews('${doc.id}')">Edit</button>
          <button class="admin-del" onclick="deleteNews('${doc.id}')">Delete</button>` : ''}
        </div>`;
      newsGrid.appendChild(card);
    });
  });
}

// Popup
function openPopup(id){
  db.collection('news').doc(id).get().then(doc=>{
    if(!doc.exists) return;
    const data = doc.data();
    document.getElementById('popupImage').src = data.image;
    document.getElementById('popupTitle').textContent = data.title;
    document.getElementById('popupContent').textContent = data.content;
    document.getElementById('newsPopup').style.display='flex';
  });
}
function closePopup(){ document.getElementById('newsPopup').style.display='none'; }

// Imgbb upload
async function uploadImage(){
  const fileInput = document.getElementById('imageFile');
  if(fileInput.files.length===0) return null;
  const file = fileInput.files[0];
  const formData = new FormData();
  formData.append("image", file);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
    method:'POST',
    body: formData
  });
  const data = await res.json();
  return data.data.url;
}

// Save News
async function saveNews(){
  const id = document.getElementById('editId').value;
  const title = document.getElementById('title').value;
  const content = document.getElementById('content').value;
  if(!title || !content){ alert('Title और Content जरूरी हैं'); return; }
  let imageURL = await uploadImage();
  if(!imageURL && !id){ alert('Image जरूरी है'); return; }

  if(id){
    const docRef = db.collection('news').doc(id);
    if(imageURL) await docRef.update({title,content,image:imageURL});
    else await docRef.update({title,content});
    alert('Updated'); clearForm();
  } else{
    await db.collection('news').add({title,content,image:imageURL});
    alert('Added'); clearForm();
  }
}

function editNews(id){
  db.collection('news').doc(id).get().then(doc=>{
    if(!doc.exists) return;
    const data = doc.data();
    document.getElementById('editId').value=id;
    document.getElementById('title').value=data.title;
    document.getElementById('content').value=data.content;
    window.scrollTo({top:0,behavior:'smooth'});
  });
}
function deleteNews(id){
  if(confirm('Are you sure?')){
    db.collection('news').doc(id).delete();
  }
}
function clearForm(){
  document.getElementById('editId').value='';
  document.getElementById('title').value='';
  document.getElementById('content').value='';
  document.getElementById('imageFile').value='';
}

// Init
loadNews();
</script>
</body>
</html>
