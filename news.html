<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vasai Live News</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

<style>
body{background:#f6f7fb;color:#0b2540;font-family:Arial,sans-serif;overflow-x:hidden;}
header{display:flex;align-items:center;justify-between;padding:8px 12px;background:#1e40af;color:white;border-radius:6px;margin-bottom:6px;position:sticky;top:0;z-index:100;}
header img{height:45px;width:45px;border-radius:6px;margin-right:8px;}
header h1{text-shadow:1px 1px 3px #000;font-weight:800;font-size:20px;}
.header-buttons button{padding:4px 8px;font-size:12px;border-radius:4px;font-weight:600;}
.ticker,.notice-ticker{color:white;padding:6px;overflow:hidden;white-space:nowrap;margin-bottom:6px;}
.ticker{background:#1e40af;}
.notice-ticker{background:#dc2626;}
.ticker span,.notice-ticker span{display:inline-block;padding-right:50px;animation:scroll 20s linear infinite;}
@keyframes scroll{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
.posts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:12px;}
.card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 6px 20px rgba(2,6,23,0.06);transition:transform 0.2s;}
.card:hover{transform:scale(1.02);}
.card img{width:100%;height:180px;object-fit:cover;}
.card-body{padding:8px;}
.card-body h3{font-weight:700;font-size:18px;margin-bottom:4px;}
.card-body p{font-size:14px;color:#555;margin-bottom:6px;}
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:200;}
.modal{background:#fff;border-radius:10px;max-width:700px;width:95%;max-height:85%;overflow-y:auto;padding:16px;position:relative;}
.modal-close{position:absolute;top:8px;right:8px;background:#f87171;color:white;border:none;border-radius:4px;padding:2px 6px;cursor:pointer;}
.modal img{max-width:100%;border-radius:6px;margin:8px 0;}
</style>
</head>
<body class="p-2">

<header>
  <div class="flex items-center">
    <img src="https://via.placeholder.com/50x50?text=VL" alt="Logo">
    <h1>Vasai Live News</h1>
  </div>
  <div class="header-buttons">
    <button id="loginBtn" class="bg-blue-700 text-white">Login</button>
    <button id="logoutBtn" class="hidden bg-red-600 text-white">Logout</button>
  </div>
</header>

<div class="ticker"><span id="tickerText">Breaking News Loading...</span></div>
<div class="notice-ticker"><span id="noticeText">Notice Loading...</span></div>

<div id="noticeEditor" class="hidden mb-2">
  <input type="text" id="noticeInput" class="border p-1 w-full rounded" placeholder="Write notice to scroll">
  <button id="saveNoticeBtn" class="bg-blue-700 text-white px-3 py-1 mt-1 rounded">Save Notice</button>
</div>

<section id="editorArea" class="hidden p-2 mb-4 bg-white rounded shadow">
  <h2 class="font-semibold mb-2">ðŸ“° Create / Edit Post</h2>
  <input id="aTitle" class="border p-2 w-full mb-2 rounded" placeholder="Title">
  <input id="aCat" class="border p-2 w-full mb-2 rounded" placeholder="Category">
  <textarea id="aText" class="border p-2 w-full mb-2 rounded" rows="5" placeholder="Write news (You can insert &lt;img src='url'&gt; tags between paragraphs)"></textarea>
  <input id="aImg" class="border p-2 w-full mb-2 rounded" placeholder="Main Image URL (optional)">
  <div class="flex gap-2">
    <button id="publishBtn" class="bg-blue-700 text-white px-4 py-2 rounded">Publish</button>
    <button id="clearBtn" class="bg-gray-200 px-4 py-2 rounded">Clear</button>
  </div>
  <p class="text-xs mt-1 text-gray-500">ðŸ’¡ You can upload image to <a href="https://imgbb.com/" target="_blank" class="text-blue-600 underline">imgbb.com</a> and paste link here.</p>
</section>

<section class="posts-grid" id="postsArea"></section>

<div id="modalBg" class="modal-bg flex">
  <div class="modal">
    <button id="modalClose" class="modal-close">X</button>
    <div id="modalContent"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, onSnapshot, orderBy, query, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain: "all-madrsa.firebaseapp.com",
  projectId: "all-madrsa",
  storageBucket: "all-madrsa.appspot.com",
  messagingSenderId: "619313835874",
  appId: "1:619313835874:web:e33f0c8bdef6d1a7f31e9f"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const ADMIN_EMAIL = "admin@example.com"; // âš ï¸ change this

let editingId = null;

// Elements
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const editorArea = document.getElementById("editorArea");
const noticeEditor = document.getElementById("noticeEditor");
const postsArea = document.getElementById("postsArea");
const noticeText = document.getElementById("noticeText");
const tickerText = document.getElementById("tickerText");
const modalBg = document.getElementById("modalBg");
const modalClose = document.getElementById("modalClose");
const modalContent = document.getElementById("modalContent");

// ðŸ” Auth
loginBtn.onclick = async () => {
  const provider = new GoogleAuthProvider();
  await signInWithPopup(auth, provider);
};
logoutBtn.onclick = () => signOut(auth);

auth.onAuthStateChanged(user => {
  if (user) {
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    if (user.email === ADMIN_EMAIL) {
      editorArea.classList.remove("hidden");
      noticeEditor.classList.remove("hidden");
    }
  } else {
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    editorArea.classList.add("hidden");
    noticeEditor.classList.add("hidden");
  }
});

// ðŸ“° Posts live
const postsRef = collection(db, "vasai_news");
onSnapshot(query(postsRef, orderBy("time", "desc")), snap => {
  const posts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderPosts(posts);
});

// ðŸš¨ Notice live
const noticeRef = doc(db, "settings", "notice");
onSnapshot(noticeRef, snap => {
  if (snap.exists()) noticeText.textContent = snap.data().text;
});
document.getElementById("saveNoticeBtn").onclick = async () => {
  const val = document.getElementById("noticeInput").value.trim();
  await setDoc(noticeRef, { text: val });
  alert("Notice updated!");
};

// âž• Publish
document.getElementById("publishBtn").onclick = async () => {
  const title = aTitle.value.trim();
  const cat = aCat.value.trim();
  const text = aText.value.trim();
  const img = aImg.value.trim();
  if (!title || !text) return alert("Please fill title and content");

  if (editingId) {
    await updateDoc(doc(db, "vasai_news", editingId), { title, category: cat, text, image: img });
    editingId = null;
  } else {
    await addDoc(postsRef, { title, category: cat, text, image: img, time: Date.now() });
  }
  clearFields();
};

document.getElementById("clearBtn").onclick = clearFields;
function clearFields(){ aTitle.value=aCat.value=aText.value=aImg.value=""; editingId=null; }

// ðŸ“° Render
function renderPosts(posts){
  postsArea.innerHTML="";
  posts.forEach(d=>{
    const img = d.image || "https://via.placeholder.com/400x200?text=News";
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<img src="${img}"><div class="card-body"><h3>${d.title}</h3><p>${(d.text.replace(/<[^>]+>/g,'').slice(0,120))}...</p><button class='bg-blue-600 text-white px-2 py-1 rounded text-sm'>Read More</button></div>`;
    card.onclick=()=>showModal(d);
    postsArea.appendChild(card);
  });
}

// ðŸ“– Modal
function showModal(d){
  modalContent.innerHTML=`<h2 class="text-xl font-bold mb-2">${d.title}</h2>
  <p class="text-sm text-gray-500 mb-2">${d.category||""}</p>
  <img src="${d.image||""}" class="mb-2 rounded">
  <div class="prose max-w-none">${d.text}</div>`;
  
  const user=auth.currentUser;
  if(user && user.email===ADMIN_EMAIL){
    const editBtn=document.createElement("button");
    editBtn.className="bg-gray-200 px-3 py-1 rounded mr-2";
    editBtn.textContent="Edit";
    editBtn.onclick=()=>{editingId=d.id;aTitle.value=d.title;aCat.value=d.category;aText.value=d.text;aImg.value=d.image;modalBg.style.display='none';};
    const delBtn=document.createElement("button");
    delBtn.className="bg-red-500 text-white px-3 py-1 rounded";
    delBtn.textContent="Delete";
    delBtn.onclick=async()=>{if(confirm("Delete this post?")) await deleteDoc(doc(db,"vasai_news",d.id)); modalBg.style.display='none';};
    modalContent.appendChild(editBtn);
    modalContent.appendChild(delBtn);
  }
  modalBg.style.display="flex";
}
modalClose.onclick=()=>modalBg.style.display="none";
modalBg.onclick=e=>{if(e.target===modalBg) modalBg.style.display="none";}

// Demo ticker
tickerText.textContent="Welcome to Vasai Live News â€” Fast, Real and Local Updates!";
</script>
</body>
</html>
