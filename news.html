<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vasai Live News — Fixed Image Click</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@keyframes scroll {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}
.ticker { overflow: hidden; white-space: nowrap; }
.ticker > span { display:inline-block; padding-right: 3rem; animation: scroll 18s linear infinite; }

.zoom-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:9999; align-items:center; justify-content:center; }
.zoom-modal img { max-width:92%; max-height:92%; border-radius:8px; box-shadow:0 8px 40px rgba(0,0,0,0.6); }
.zoom-close { position:absolute; top:18px; right:22px; background:#fff; border-radius:999px; width:38px; height:38px; display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; }

.modal-bg { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:900; align-items:center; justify-content:center; }
.modal-card { width:95%; max-width:760px; max-height:85vh; overflow:auto; background:#fff; border-radius:10px; padding:18px; box-shadow:0 10px 40px rgba(2,6,23,0.2); }

.card-img { width:100%; height:180px; object-fit:cover; border-radius:8px; }
.card { transition: transform 0.15s ease, box-shadow 0.15s ease; cursor:pointer; }
.card:hover { transform: translateY(-4px); box-shadow:0 10px 30px rgba(2,6,23,0.08); }
</style>
</head>
<body class="bg-gray-100 text-gray-800">

<header class="sticky top-0 z-50 bg-blue-800 text-white shadow">
  <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <img src="https://i.postimg.cc/vTb8F94w/vasalive-png.jpg" class="h-10 w-10 rounded" />
      <h1 class="font-bold text-xl">Vasai Live News</h1>
    </div>
  </div>
</header>

<!-- Tickers -->
<div class="max-w-6xl mx-auto px-4 mt-3">
  <div class="bg-red-600 text-white rounded px-3 py-2 mb-2"><div class="ticker"><span id="noticeText">Loading notices...</span></div></div>
  <div class="bg-blue-700 text-white rounded px-3 py-2"><div class="ticker"><span id="headlineText">Loading headlines...</span></div></div>
</div>

<!-- Posts -->
<main class="max-w-6xl mx-auto px-4 mt-6">
  <section id="postsArea" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></section>
</main>

<!-- Article Modal -->
<div id="modalBg" class="modal-bg flex">
  <div class="modal-card">
    <div class="flex justify-between items-start mb-3">
      <h3 id="modalTitle" class="text-xl font-bold"></h3>
      <button id="modalClose" class="bg-gray-200 px-3 py-1 rounded">Close</button>
    </div>
    <div id="modalContent" class="space-y-3"></div>
  </div>
</div>

<!-- Zoom Modal -->
<div id="zoomModal" class="zoom-modal flex">
  <div id="zoomClose" class="zoom-close">×</div>
  <img id="zoomImg" src="" alt="Zoom" />
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e33f0c8bdef6d1a7f31e9f"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const postsArea = document.getElementById("postsArea");
const noticeText = document.getElementById("noticeText");
const headlineText = document.getElementById("headlineText");
const modalBg = document.getElementById("modalBg");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const modalClose = document.getElementById("modalClose");
const zoomModal = document.getElementById("zoomModal");
const zoomImg = document.getElementById("zoomImg");
const zoomClose = document.getElementById("zoomClose");

/* live data */
onSnapshot(query(collection(db,"vasai_news"),orderBy("time","desc")),snap=>{
  const posts=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderPosts(posts);
  headlineText.textContent = posts.slice(0,5).map(p=>p.title).join(" — ");
});
onSnapshot(doc(db,"settings","notice"),snap=>{
  noticeText.textContent = snap.exists() ? snap.data().text : "";
});

/* render posts */
function renderPosts(posts){
  postsArea.innerHTML="";
  posts.forEach(d=>{
    const img=d.blocks.find(b=>b.type==="image")?.url || "https://via.placeholder.com/600x360?text=No+Image";
    const txt=d.blocks.find(b=>b.type==="text")?.text?.substring(0,120)+"..." || "";
    const card=document.createElement("div");
    card.className="card bg-white rounded-lg p-3 shadow-sm";
    card.innerHTML=`
      <img src="${img}" class="card-img mb-3" />
      <h3 class="font-semibold text-lg mb-1">${d.title}</h3>
      <p class="text-sm text-gray-600">${txt}</p>`;
    /* click — open full article */
    card.addEventListener("click",()=>openArticle(d));
    postsArea.appendChild(card);
  });
}

/* open full article */
function openArticle(post){
  modalTitle.textContent = post.title;
  modalContent.innerHTML="";
  post.blocks.forEach(b=>{
    if(b.type==="text"){
      const p=document.createElement("p");
      p.textContent=b.text;
      p.className="text-gray-800 leading-relaxed";
      modalContent.appendChild(p);
    }
    if(b.type==="image"){
      const i=document.createElement("img");
      i.src=b.url;
      i.className="w-full rounded cursor-zoom-in";
      i.addEventListener("click",()=>openZoom(b.url));
      modalContent.appendChild(i);
    }
  });
  modalBg.style.display="flex";
}

/* zoom image inside modal */
function openZoom(url){
  zoomImg.src=url;
  zoomModal.style.display="flex";
}

modalClose.onclick=()=>modalBg.style.display="none";
modalBg.onclick=(e)=>{if(e.target===modalBg)modalBg.style.display="none";};

zoomClose.onclick=()=>zoomModal.style.display="none";
zoomModal.onclick=(e)=>{if(e.target===zoomModal)zoomModal.style.display="none";};
</script>
</body>
</html>
