<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>News Portal</title>
<style>
:root{
  --green:#116530;
  --accent:#008069;
  --muted:#777;
  --card-radius:12px;
  --card-h:250px;
}
body { font-family:"Segoe UI", sans-serif; margin:0; background:#f5f7f5; color:#222; }

/* Header */
.site-header{
  position:sticky; top:0; z-index:60;
  background: linear-gradient(135deg,#6ec1ff,#3aa8ff);
  padding:8px 10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.12);
}
.logo-row{text-align:center;}
.logo-3d{
  display:inline-block;font-size:28px;font-weight:900;color:#fff;
  padding:6px 12px;border-radius:8px;text-shadow:0 2px 0 rgba(0,0,0,0.15);
}
.button-row{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; padding:6px 4px;}
.header-btn{
  display:inline-flex; align-items:center; gap:6px; background:#fff; color:#0b63a6;
  padding:8px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700;
}
.header-btn:hover{ filter:brightness(0.95); }

/* Main */
main{ max-width:1100px; margin:18px auto; padding:0 16px 60px; }

/* Admin Form */
#memberForm{ display:none; background:white; padding:16px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); margin:14px 0;}
#memberForm input, #memberForm textarea{ width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ddd; }

/* Grid Cards */
.grid{ display:grid; gap:14px; grid-template-columns:repeat(2,1fr); }
@media(min-width:768px){ .grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1024px){ .grid{ grid-template-columns:repeat(4,1fr); } }

.card{ background:white; border-radius:var(--card-radius); height:var(--card-h); display:flex; flex-direction:column; box-shadow:0 6px 18px rgba(0,0,0,0.08); cursor:pointer; transition:transform .15s; }
.card:hover{ transform:translateY(-4px);}
.card img{ width:100%; height:150px; object-fit:cover; border-radius:12px 12px 0 0; }
.card-body{ padding:10px; flex:1; display:flex; flex-direction:column; gap:4px; }
.card-footer{ padding:8px; display:flex; gap:6px; flex-wrap:wrap; }
.btn-edit{ background:#ffc107; color:#333; padding:5px 8px; border:none; border-radius:6px; cursor:pointer; }
.btn-del{ background:#dc3545; color:#fff; padding:5px 8px; border:none; border-radius:6px; cursor:pointer; }

/* Popup */
#newsPopup{ display:none; position:fixed; inset:0; justify-content:center; align-items:center; background:rgba(0,0,0,0.55); z-index:70; padding:10px; overflow:auto;}
.popup-card{ background:white; max-width:800px; width:100%; border-radius:12px; position:relative; padding:16px;}
.popup-card img{ width:100%; max-height:400px; object-fit:cover; border-radius:8px; }
.close-btn{ position:absolute; top:10px; right:10px; background:#eee; border:none; padding:6px 10px; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>

<header class="site-header">
  <div class="logo-row"><div class="logo-3d">News Portal</div></div>
  <nav class="button-row">
    <button class="header-btn" id="loginBtn" onclick="googleLogin()">Admin Login</button>
    <button class="header-btn" id="logoutBtn" onclick="logout()" style="display:none;">Logout</button>
  </nav>
</header>

<main>
  <!-- Admin Form -->
  <section id="memberForm">
    <h3>News Add/Edit (Admin)</h3>
    <input type="hidden" id="editId">
    <input type="text" id="title" placeholder="Title">
    <textarea id="content" placeholder="Full news content"></textarea>
    <input type="file" id="newsImage" accept="image/*">
    <button onclick="saveNews()">Save</button>
  </section>

  <div class="grid" id="cardsGrid"></div>
</main>

<!-- News Popup -->
<div id="newsPopup">
  <div class="popup-card">
    <button class="close-btn" onclick="closePopup()">❌</button>
    <h2 id="popupTitle"></h2>
    <img id="popupImage" src="">
    <p id="popupContent"></p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e387e1297663f11fc2463b11fc2463b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
const ADMIN_EMAIL = "zaradigitalseva@gmail.com";
const IMGBB_API_KEY = "YOUR_IMGBB_API_KEY";

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const cardsGrid = document.getElementById('cardsGrid');

// Auth state
auth.onAuthStateChanged(user=>{
  if(user && user.email===ADMIN_EMAIL){
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-flex';
    document.getElementById('memberForm').style.display='block';
  } else{
    loginBtn.style.display='inline-flex';
    logoutBtn.style.display='none';
    document.getElementById('memberForm').style.display='none';
  }
});

// Login/Logout
function googleLogin(){
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(err=>alert(err.message));
}
function logout(){ auth.signOut(); }

// Load News
function loadNews(){
  cardsGrid.innerHTML='';
  db.collection("news").orderBy('title').onSnapshot(snapshot=>{
    snapshot.forEach(doc=>{
      const data = doc.data();
      const card = document.createElement('div'); card.className='card';
      card.innerHTML=`
        <img src="${data.image}" alt="${data.title}">
        <div class="card-body">
          <h3>${data.title}</h3>
        </div>
        <div class="card-footer">
          <button onclick="openPopup('${doc.id}')">Read More</button>
          ${auth.currentUser && auth.currentUser.email===ADMIN_EMAIL ? `
          <button class="btn-edit" onclick="editNews('${doc.id}')">Edit</button>
          <button class="btn-del" onclick="deleteNews('${doc.id}')">Delete</button>` : ''}
        </div>`;
      cardsGrid.appendChild(card);
    });
  });
}

// Popup
function openPopup(id){
  db.collection("news").doc(id).get().then(doc=>{
    if(!doc.exists) return;
    const data=doc.data();
    document.getElementById('popupTitle').textContent=data.title;
    document.getElementById('popupContent').textContent=data.content;
    document.getElementById('popupImage').src=data.image;
    document.getElementById('newsPopup').style.display='flex';
  });
}
function closePopup(){ document.getElementById('newsPopup').style.display='none'; }

// Image Upload via Imgbb
async function uploadImage(){
  const fileInput=document.getElementById('newsImage');
  if(fileInput.files.length===0) return null;
  const file=fileInput.files[0];
  const formData=new FormData();
  formData.append('image',file);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,{method:'POST',body:formData});
  const data = await res.json();
  return data.data.url;
}

// Admin Save News
async function saveNews(){
  const id=document.getElementById('editId').value;
  const title=document.getElementById('title').value;
  const content=document.getElementById('content').value;
  if(!title || !content){ alert("Title और Content जरूरी हैं"); return;}
  const imageURL = await uploadImage();
  if(!imageURL){ alert("Image जरूरी है"); return;}

  if(id){
    db.collection('news').doc(id).update({title,content,image:imageURL})
      .then(()=>{ alert("Updated"); clearForm(); });
  } else{
    db.collection('news').add({title,content,image:imageURL})
      .then(()=>{ alert("Added"); clearForm(); });
  }
}

function editNews(id){
  db.collection('news').doc(id).get().then(doc=>{
    if(!doc.exists) return;
    const data=doc.data();
    document.getElementById('editId').value=id;
    document.getElementById('title').value=data.title;
    document.getElementById('content').value=data.content;
  });
}

function deleteNews(id){
  if(confirm("Delete करना चाहते हैं?")){
    db.collection('news').doc(id).delete().catch(err=>alert(err.message));
  }
}

function clearForm(){
  document.getElementById('title').value='';
  document.getElementById('content').value='';
  document.getElementById('newsImage').value='';
  document.getElementById('editId').value='';
}

// Init
loadNews();
</script>
</body>
</html>
