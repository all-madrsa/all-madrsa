<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gallery | Talimi Ittehad</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#f1f5f9; }

/* Notice Bar */
#noticeBar {
  width: 100%;
  background: #fffae6;
  overflow: hidden;
  border-bottom: 2px solid #facc15;
  white-space: nowrap;
  box-sizing: border-box;
  position: relative;
  padding: 5px 0;
}
#noticeContent {
  display: inline-block;
  white-space: nowrap;
  padding-left: 100%;
}
.notice-item {
  display: inline-block;
  margin-right: 50px;
  font-weight: bold;
  color: #b45309;
}
.admin-btn {
  margin-left:5px;
  background:#dc2626;
  color:#fff;
  border:none;
  padding:2px 5px;
  border-radius:3px;
  cursor:pointer;
  font-size:0.7rem;
}

/* Gallery */
.gallery-img { cursor:pointer; transition:transform .2s; }
.gallery-img:hover { transform:scale(1.05); }

#lightbox { display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:50; align-items:center; justify-content:center; }
#lightbox img { max-height:90%; max-width:90%; border-radius:.5rem; box-shadow:0 0 20px rgba(0,0,0,.6); }
#lightbox button { position:absolute; top:20px; right:20px; background:#f44336; color:#fff; padding:6px 12px; border-radius:6px; }

</style>
</head>
<body>

<!-- Notice Bar -->
<div id="noticeBar">
  <div id="noticeContent"></div>
</div>

<!-- Admin Upload Form -->
<div id="adminBox" class="hidden p-3 bg-white max-w-md mx-auto mt-3 rounded shadow">
  <h2 class="font-bold mb-2">Admin Panel</h2>
  <input type="text" id="noticeInput" placeholder="Add new notice" class="border p-1 mb-2 w-full rounded"/>
  <button id="addNoticeBtn" class="bg-blue-600 text-white px-3 py-1 rounded mb-3">Add Notice</button>
</div>

<!-- Gallery -->
<main class="max-w-6xl mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">📸 Gallery</h1>
  <div id="galleryGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
</main>

<!-- Lightbox -->
<div id="lightbox" class="flex">
  <img src="" alt="preview" id="lightbox-img">
  <button id="closeLightbox">✖</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain:"all-madrsa.firebaseapp.com",
  databaseURL:"https://all-madrsa-default-rtdb.firebaseio.com",
  projectId:"all-madrsa",
  storageBucket:"all-madrsa.appspot.com",
  messagingSenderId:"619313835874",
  appId:"1:619313835874:web:e387e1297663b11fc2463b11fc2463b"
};

const ADMIN_EMAIL = "zaradigitalseva@gmail.com";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const noticeContent = document.getElementById("noticeContent");
const adminBox = document.getElementById("adminBox");
const noticeInput = document.getElementById("noticeInput");
const addNoticeBtn = document.getElementById("addNoticeBtn");

let currentUser = null;

// Load Notices
async function loadNotices(){
  noticeContent.innerHTML = "";
  const q = query(collection(db,"notices"),orderBy("createdAt","desc"));
  const snap = await getDocs(q);
  if(snap.empty){
    noticeContent.textContent = "No notices yet.";
    return;
  }
  snap.docs.forEach(docSnap=>{
    const d = docSnap.data();
    const span = document.createElement("span");
    span.className="notice-item";
    span.textContent = d.text;

    if(currentUser?.email===ADMIN_EMAIL){
      const editBtn = document.createElement("button");
      editBtn.textContent="✏️";
      editBtn.className="admin-btn";
      editBtn.onclick=async()=>{
        const newText = prompt("Edit notice:", d.text);
        if(newText!==null){
          await updateDoc(doc(db,"notices",docSnap.id),{text:newText});
          loadNotices();
        }
      };
      const delBtn = document.createElement("button");
      delBtn.textContent="🗑";
      delBtn.className="admin-btn";
      delBtn.onclick=async()=>{
        if(confirm("Delete this notice?")){
          await deleteDoc(doc(db,"notices",docSnap.id));
          loadNotices();
        }
      };
      span.appendChild(editBtn);
      span.appendChild(delBtn);
    }

    noticeContent.appendChild(span);
  });

  // Dynamic scrolling
  const totalWidth = noticeContent.scrollWidth;
  const parentWidth = noticeContent.parentElement.offsetWidth;
  const duration = Math.max(totalWidth / 50, 10); // 50px/sec, min 10s
  noticeContent.style.animation = `scrollNotice ${duration}s linear infinite`;
}

// Add Notice
addNoticeBtn.onclick=async()=>{
  const text = noticeInput.value.trim();
  if(!text) return;
  await addDoc(collection(db,"notices"),{text, createdAt:serverTimestamp()});
  noticeInput.value="";
  loadNotices();
}

// Auth
onAuthStateChanged(auth,user=>{
  currentUser = user;
  if(user?.email===ADMIN_EMAIL){ adminBox.classList.remove("hidden"); }
  else{ adminBox.classList.add("hidden"); }
  loadNotices();
});

// Lightbox close
document.getElementById("closeLightbox").onclick=()=>document.getElementById("lightbox").style.display="none";
document.getElementById("lightbox").onclick=e=>{ if(e.target.id==="lightbox") document.getElementById("lightbox").style.display="none"; };

// CSS keyframes dynamic
const styleEl = document.createElement('style');
styleEl.innerHTML = `
@keyframes scrollNotice {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}
#noticeContent:hover { animation-play-state: paused; }
`;
document.head.appendChild(styleEl);
</script>

</body>
</html>
