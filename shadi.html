<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíç Shadi Profile Submit</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<section class="p-4 max-w-xl mx-auto bg-white rounded shadow mt-4">
<h2 class="text-xl font-bold mb-2 text-purple-700">Add Marriage Profile</h2>
<form id="profileForm" class="flex flex-col gap-2">
  <input id="nameInput" type="text" placeholder="Full Name" class="p-2 border rounded" required>
  <select id="genderInput" class="p-2 border rounded" required>
    <option value="">Select Gender</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select>
  <input id="ageInput" type="number" placeholder="Age" class="p-2 border rounded" required>
  <input id="educationInput" type="text" placeholder="Education" class="p-2 border rounded">
  <input id="occupationInput" type="text" placeholder="Occupation" class="p-2 border rounded">
  <input id="incomeInput" type="text" placeholder="Income" class="p-2 border rounded">
  <input id="addressInput" type="text" placeholder="Full Address" class="p-2 border rounded">
  <input id="mobileInput" type="text" placeholder="Mobile / WhatsApp Number" class="p-2 border rounded">
  <select id="maritalStatusInput" class="p-2 border rounded">
    <option value="">Marital Status</option>
    <option value="Single">Single</option>
    <option value="Married">Married</option>
    <option value="Divorced">Divorced</option>
    <option value="Widowed">Widowed</option>
  </select>
  <input id="childrenInput" type="text" placeholder="Children Info (if any)" class="p-2 border rounded">
  <input id="familyInfoInput" type="text" placeholder="Family Info" class="p-2 border rounded">
  <label class="text-sm font-semibold">Photo</label>
  <input id="photoInput" type="file" class="p-2 border rounded" required>
  <label class="text-sm font-semibold">Aadhaar Card</label>
  <input id="aadhaarInput" type="file" class="p-2 border rounded" required>
  <button type="submit" class="bg-purple-600 text-white p-2 rounded mt-2">Submit Profile</button>
</form>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain: "all-madrsa.firebaseapp.com",
  projectId: "all-madrsa",
  storageBucket: "all-madrsa.appspot.com",
  messagingSenderId: "619313835874",
  appId: "1:619313835874:web:e387e1297663f11fc2463f11"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const profileForm = document.getElementById("profileForm");
let currentUser = null;

// Login silently or add login button
onAuthStateChanged(auth, user => {
  currentUser = user;
  if(!user) alert("Please login with Google to post profile!");
});

// IMGBB upload function
async function uploadToImgbb(file) {
  const apiKey = "3701b37092582c6aa3b6f8d1d3dcd00d";
  const formData = new FormData();
  formData.append("image", file);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
    method: "POST",
    body: formData
  });
  const data = await res.json();
  return data.data.url;
}

// Form submit
profileForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  if(!currentUser) return alert("Login required!");

  const name = document.getElementById("nameInput").value;
  const gender = document.getElementById("genderInput").value;
  const age = document.getElementById("ageInput").value;
  const education = document.getElementById("educationInput").value;
  const occupation = document.getElementById("occupationInput").value;
  const income = document.getElementById("incomeInput").value;
  const address = document.getElementById("addressInput").value;
  const mobile = document.getElementById("mobileInput").value;
  const maritalStatus = document.getElementById("maritalStatusInput").value;
  const children = document.getElementById("childrenInput").value;
  const familyInfo = document.getElementById("familyInfoInput").value;
  const photoFile = document.getElementById("photoInput").files[0];
  const aadhaarFile = document.getElementById("aadhaarInput").files[0];

  if(!photoFile || !aadhaarFile) return alert("Photo and Aadhaar required!");

  // Upload both files
  const photoUrl = await uploadToImgbb(photoFile);
  const aadhaarUrl = await uploadToImgbb(aadhaarFile);

  // Submit to Firestore
  await addDoc(collection(db,"profiles"),{
    name, gender, age, education, occupation, income, address, mobile,
    maritalStatus, children, familyInfo, photoUrl, aadhaarUrl,
    uid: currentUser.uid,
    email: currentUser.email,
    approved: false,
    created: serverTimestamp()
  });

  alert("‚úÖ Profile submitted, waiting for admin approval!");
  profileForm.reset();
});
</script>
</body>
</html>
