<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>📜 Hadees Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('madina.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .card {
      border-radius: 12px;
      padding: 1rem;
      margin: 0.5rem 0;
      color: white;
      font-weight: 500;
    }
    .popup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none; justify-content: center; align-items: center;
    }
    .popup-content {
      background: white; padding: 20px; border-radius: 10px;
      max-width: 500px; width: 90%;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- 🔹 Header -->
  <header class="bg-blue-700 text-white py-3 px-4 flex justify-between">
    <h1 class="text-xl font-bold">📜 Hadees</h1>
    <div>
      <button id="loginBtn" class="bg-green-500 px-3 py-1 rounded">Login</button>
      <button id="logoutBtn" class="bg-red-500 px-3 py-1 rounded hidden">Logout</button>
    </div>
  </header>

  <!-- 🔹 Post Box (only after login) -->
  <div id="postBox" class="hidden bg-white p-4 m-4 rounded shadow">
    <textarea id="hadeesInput" placeholder="अपनी हदीस लिखें..." 
      class="w-full p-2 border rounded"></textarea>
    <button id="postBtn" 
      class="mt-2 px-4 py-2 bg-green-600 text-white rounded">📩 Post</button>
  </div>

  <!-- 🔹 Posts List -->
  <main id="postsList" class="flex-1 p-4"></main>

  <!-- 🔹 Popup -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <p id="popupText"></p>
      <div class="flex justify-between mt-4">
        <button id="closePopup" class="bg-gray-500 text-white px-3 py-1 rounded">❌ Close</button>
        <button id="nextPopup" class="bg-blue-500 text-white px-3 py-1 rounded">➡️ Next</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔹 Firebase Config (apna config lagao)
   const firebaseConfig = {
  apiKey: "AIzaSyDMvkPqFKDjrMaLlBkercBYoLxEs1GEbng",
  authDomain: "all-madrsa.firebaseapp.com",
  projectId: "all-madrsa",
  storageBucket: "all-madrsa.appspot.com",
  messagingSenderId: "619313835874",
  appId: "1:619313835874:web:e387e1297663f11fc2463b"
};
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const postBox = document.getElementById("postBox");
    const postBtn = document.getElementById("postBtn");
    const hadeesInput = document.getElementById("hadeesInput");
    const postsList = document.getElementById("postsList");

    const popup = document.getElementById("popup");
    const popupText = document.getElementById("popupText");
    const closePopup = document.getElementById("closePopup");
    const nextPopup = document.getElementById("nextPopup");
    let popupPosts = [];
    let popupIndex = 0;

    const ADMIN_EMAIL = "zaradigitalseva@gmail.com";

    // 🔹 Login
    loginBtn.addEventListener("click", async () => {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    });

    // 🔹 Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // 🔹 Auth State
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
        postBox.classList.remove("hidden");
      } else {
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
        postBox.classList.add("hidden");
      }
    });

    // 🔹 Post Hadees
    postBtn.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) { alert("⚠️ पहले login करें!"); return; }

      const text = hadeesInput.value.trim();
      if (!text) return alert("❌ खाली नहीं हो सकता!");

      await addDoc(collection(db, "hadees"), {
        text, uid: user.uid, email: user.email,
        approved: false, createdAt: serverTimestamp()
      });
      hadeesInput.value = "";
      alert("✅ Review के लिए भेज दिया गया!");
    });

    // 🔹 Load Posts
    onSnapshot(collection(db, "hadees"), (snapshot) => {
      postsList.innerHTML = "";
      popupPosts = [];
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const id = docSnap.id;
        const color = ["bg-red-500","bg-green-500","bg-blue-500","bg-purple-500","bg-pink-500"];
        const randomColor = color[Math.floor(Math.random()*color.length)];

        if (data.approved || (auth.currentUser && auth.currentUser.email===ADMIN_EMAIL)) {
          const card = document.createElement("div");
          card.className = `card ${randomColor} cursor-pointer`;
          card.innerText = data.text.substring(0,50) + "...";
          card.addEventListener("click", () => {
            popup.style.display="flex";
            popupText.innerText = data.text;
            popupPosts = snapshot.docs.filter(d=>d.data().approved).map(d=>d.data().text);
            popupIndex = popupPosts.indexOf(data.text);
          });

          // admin options
          if (auth.currentUser && auth.currentUser.email===ADMIN_EMAIL) {
            const btns = document.createElement("div");
            btns.className="mt-2 flex gap-2";
            if (!data.approved) {
              const approveBtn = document.createElement("button");
              approveBtn.innerText="✅ Approve";
              approveBtn.className="bg-green-700 px-2 py-1 rounded";
              approveBtn.onclick=()=>updateDoc(doc(db,"hadees",id),{approved:true});
              btns.appendChild(approveBtn);
            }
            const rejectBtn = document.createElement("button");
            rejectBtn.innerText="🚫 Reject";
            rejectBtn.className="bg-yellow-700 px-2 py-1 rounded";
            rejectBtn.onclick=()=>updateDoc(doc(db,"hadees",id),{approved:false});
            btns.appendChild(rejectBtn);

            const delBtn = document.createElement("button");
            delBtn.innerText="🗑 Delete";
            delBtn.className="bg-red-700 px-2 py-1 rounded";
            delBtn.onclick=()=>deleteDoc(doc(db,"hadees",id));
            btns.appendChild(delBtn);

            card.appendChild(btns);
          }

          postsList.appendChild(card);
        }
      });
    });

    // 🔹 Popup controls
    closePopup.addEventListener("click", ()=>popup.style.display="none");
    nextPopup.addEventListener("click", ()=>{
      popupIndex = (popupIndex+1) % popupPosts.length;
      popupText.innerText = popupPosts[popupIndex];
    });
  </script>
</body>
</html>
